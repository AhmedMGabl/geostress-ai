<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoStress AI - Industrial Fracture Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="d-none">
        <div class="spinner-border text-light" role="status" style="width:3rem;height:3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div class="text-light mt-3 fs-5" id="loading-text">Processing...</div>
        <div class="progress mt-3" style="width:300px;height:8px;display:none" id="loading-progress">
            <div class="progress-bar bg-info" id="loading-bar" style="width:0%"></div>
        </div>
        <div class="text-light small mt-1" id="loading-detail"></div>
    </div>

    <div class="d-flex" style="min-height:100vh">
        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h4><i class="bi bi-layers-half"></i> GeoStress AI</h4>
                <small class="text-muted-light">Industrial Fracture Analysis v3.17</small>
                <small class="text-muted-light d-block mt-1"><i class="bi bi-clock"></i> Last: <span id="response-time">-</span></small>
            </div>

            <ul class="nav flex-column sidebar-nav">
                <li class="nav-item">
                    <a class="nav-link active" data-tab="executive" href="#">
                        <i class="bi bi-speedometer2"></i> Executive Summary
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="data" href="#">
                        <i class="bi bi-table"></i> Data Overview
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="viz" href="#">
                        <i class="bi bi-pie-chart"></i> Visualizations
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="inversion" href="#">
                        <i class="bi bi-gear-wide-connected"></i> Stress Inversion
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="models" href="#">
                        <i class="bi bi-bar-chart-line"></i> Model Comparison
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="shap" href="#">
                        <i class="bi bi-lightbulb"></i> Why It Predicts
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="classify" href="#">
                        <i class="bi bi-diagram-3"></i> ML Classification
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="cluster" href="#">
                        <i class="bi bi-bullseye"></i> Fracture Clustering
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="sensitivity" href="#">
                        <i class="bi bi-sliders"></i> Sensitivity
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="risk" href="#">
                        <i class="bi bi-shield-exclamation"></i> Risk Matrix
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="near-miss" href="#">
                        <i class="bi bi-exclamation-diamond"></i> Near-Miss Safety
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="uncertainty" href="#">
                        <i class="bi bi-clipboard-pulse"></i> Uncertainty Budget
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="wells" href="#">
                        <i class="bi bi-building"></i> Well Comparison
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="report" href="#">
                        <i class="bi bi-file-earmark-text"></i> Well Report
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="feedback" href="#">
                        <i class="bi bi-chat-dots"></i> Feedback
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="calibration" href="#">
                        <i class="bi bi-bullseye"></i> Calibration
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="decision" href="#">
                        <i class="bi bi-signpost-split"></i> Decisions
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="scenarios" href="#">
                        <i class="bi bi-sliders"></i> Scenarios
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="montecarlo" href="#">
                        <i class="bi bi-dice-5"></i> Monte Carlo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="validation" href="#">
                        <i class="bi bi-check2-all"></i> Data Validation
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="audit" href="#">
                        <i class="bi bi-shield-check"></i> Audit Trail
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="research" href="#">
                        <i class="bi bi-mortarboard"></i> Research & Methods
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="glossary" href="#">
                        <i class="bi bi-book"></i> Glossary
                    </a>
                </li>
                <li class="nav-item mt-2">
                    <small class="text-muted-light px-3">MLOps</small>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-tab="mlops" href="#">
                        <i class="bi bi-gear-wide-connected"></i> Production MLOps
                    </a>
                </li>
            </ul>

            <!-- Parameters -->
            <div class="sidebar-section">
                <h6 class="sidebar-heading">Parameters</h6>
                <div class="mb-2">
                    <label class="form-label-sm">Well</label>
                    <select id="well-select" class="form-select form-select-sm">
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label-sm">Stress Regime</label>
                    <select id="regime-select" class="form-select form-select-sm">
                        <option value="auto" selected>Auto (Best Fit)</option>
                        <option value="strike_slip">Strike-Slip</option>
                        <option value="normal">Normal</option>
                        <option value="thrust">Thrust</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label-sm">Depth (m)</label>
                    <input type="number" id="depth-input" class="form-control form-control-sm" value="3300" min="500" max="6000">
                </div>
                <div class="mb-2">
                    <label class="form-label-sm">Pore Pressure (MPa)
                        <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Hydrostatic estimate used if left empty. Pore pressure reduces effective normal stress on fractures, shifting Mohr circles left."></i>
                    </label>
                    <input type="number" id="pp-input" class="form-control form-control-sm" placeholder="Auto (hydrostatic)" step="0.1" min="0" max="200">
                </div>
                <div class="mb-2">
                    <label class="form-label-sm">Geothermal Gradient (°C/km)
                        <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Rate of temperature increase with depth. Default 30°C/km. Higher values (>35) indicate hot basins — friction correction activates at temperatures >150°C."></i>
                    </label>
                    <input type="number" id="geothermal-input" class="form-control form-control-sm" value="30" step="1" min="15" max="60">
                </div>
            </div>

            <!-- Full Pipeline -->
            <div class="sidebar-section">
                <button id="btn-pipeline" class="btn btn-warning btn-sm w-100 fw-bold" onclick="runFullPipeline()">
                    <i class="bi bi-rocket-takeoff"></i> Run Full Pipeline
                </button>
                <div class="small text-muted-light mt-1">Chains all analyses in one click</div>
            </div>

            <!-- Upload -->
            <div class="sidebar-section">
                <h6 class="sidebar-heading">Upload Data</h6>
                <p class="text-muted-light small mb-1" style="font-size:0.7rem">Upload your Excel files (Depth, Azimuth, Dip) to improve accuracy with your own well data.</p>
                <input type="file" id="file-upload" class="form-control form-control-sm" accept=".xls,.xlsx">
                <div id="upload-status" class="small mt-1"></div>
                <div class="mt-2">
                    <span class="badge" id="data-source-badge">Demo Data</span>
                </div>
                <button id="btn-use-demo" class="btn btn-outline-light btn-sm mt-1 d-none" onclick="switchToDemo()">
                    Back to Demo Data
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow-1">
            <!-- Top bar -->
            <div class="topbar d-flex align-items-center justify-content-between px-4">
                <div>
                    <span id="page-title" class="fw-semibold fs-5">Data Overview</span>
                    <span class="text-muted ms-2" id="fracture-count-badge"></span>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <span class="text-muted small">AI-Powered Geostress Analysis for Oil &amp; Gas</span>
                </div>
            </div>

            <div class="content-area p-4">
                <!-- Industrial Disclaimer Banner -->
                <div id="industrial-disclaimer" class="alert alert-warning border-warning py-2 mb-3 small d-flex align-items-start">
                    <i class="bi bi-shield-exclamation text-warning me-2 mt-1 fs-6"></i>
                    <div>
                        <strong>Industrial Use Notice:</strong>
                        This tool provides AI-assisted geostress estimates for planning purposes.
                        Results are <u>not</u> a substitute for certified geomechanical analysis by a qualified engineer.
                        Stress magnitudes require field calibration (LOT/XLOT/DFIT) before use in casing or completion design.
                        Always validate against independent data sources before operational decisions.
                        <a href="#" onclick="document.getElementById('industrial-disclaimer').classList.add('d-none'); return false;" class="ms-2 text-decoration-none"><i class="bi bi-x-circle"></i> Dismiss</a>
                    </div>
                </div>
                <!-- Pipeline Progress Panel -->
                <div id="pipeline-panel" class="d-none mb-4">
                    <div class="card border-warning">
                        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center py-2">
                            <span><i class="bi bi-rocket-takeoff"></i> <strong>Full Analysis Pipeline</strong></span>
                            <button class="btn btn-sm btn-outline-dark" onclick="closePipelinePanel()"><i class="bi bi-x-lg"></i></button>
                        </div>
                        <div class="card-body py-3">
                            <div id="pipeline-steps" class="d-flex gap-1 mb-2 flex-wrap"></div>
                            <div class="progress mb-2" style="height:6px">
                                <div id="pipeline-bar" class="progress-bar bg-warning" style="width:0%;transition:width 0.3s"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small id="pipeline-status" class="text-muted">Preparing...</small>
                                <small id="pipeline-elapsed" class="text-muted"></small>
                            </div>
                            <div id="pipeline-summary" class="d-none mt-3"></div>
                        </div>
                    </div>
                </div>

                <!-- EXECUTIVE SUMMARY TAB -->
                <div id="tab-executive" class="tab-content active">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="mb-1"><i class="bi bi-speedometer2"></i> Executive Summary</h4>
                            <p class="text-muted mb-0">Plain-language overview for decision-makers. No jargon, just actionable insights.</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary btn-sm" onclick="runExecutiveSummary()">
                                <i class="bi bi-arrow-clockwise"></i> Generate Summary
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="runSufficiencyCheck()">
                                <i class="bi bi-clipboard-check"></i> Data Sufficiency
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="runSafetyCheck()">
                                <i class="bi bi-shield-exclamation"></i> Safety Check
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="runFieldConsistency()">
                                <i class="bi bi-globe2"></i> Field Consistency
                            </button>
                            <button class="btn btn-success btn-sm" onclick="runEvidenceChain()">
                                <i class="bi bi-list-check"></i> Full Evidence Chain
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="runGuidedWizard()">
                                <i class="bi bi-signpost-split"></i> Guided Wizard
                            </button>
                            <button class="btn btn-dark btn-sm" onclick="exportPdfReport()">
                                <i class="bi bi-file-earmark-pdf"></i> PDF Report
                            </button>
                            <button class="btn btn-success btn-sm" onclick="exportFullJsonReport()">
                                <i class="bi bi-filetype-json"></i> JSON Report
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="runBatchAnalysis()">
                                <i class="bi bi-collection"></i> Batch All Wells
                            </button>
                            <button class="btn btn-outline-dark btn-sm" onclick="runDecisionReadiness()">
                                <i class="bi bi-clipboard-check"></i> Decision Readiness
                            </button>
                        </div>
                    </div>

                    <!-- Decision Readiness -->
                    <div id="readiness-results" class="d-none mb-4">
                        <div class="card border-dark">
                            <div class="card-header bg-dark text-white">
                                <i class="bi bi-clipboard-check"></i> Decision Readiness Assessment
                            </div>
                            <div class="card-body" id="readiness-body"></div>
                        </div>
                    </div>

                    <!-- Overall Risk Banner -->
                    <div id="exec-risk-banner" class="d-none mb-4">
                        <div id="exec-risk-alert" class="alert p-4"></div>
                    </div>

                    <!-- GO/NO-GO Decision Matrix -->
                    <div id="exec-decision-matrix" class="d-none mb-4"></div>

                    <!-- Field Calibration Status -->
                    <div id="exec-calibration" class="d-none mb-4">
                        <div class="card" id="exec-cal-card">
                            <div class="card-header">
                                <i class="bi bi-geo-alt me-1"></i> Field Calibration Status
                            </div>
                            <div class="card-body" id="exec-cal-body"></div>
                        </div>
                    </div>

                    <!-- Summary Sections -->
                    <div id="exec-sections" class="mb-4"></div>

                    <!-- Evidence Chain Results -->
                    <div id="evidence-results" class="d-none mb-4">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white"><i class="bi bi-list-check"></i> Evidence Chain — Decision Support</div>
                            <div class="card-body">
                                <div id="evidence-summary" class="alert mb-3"></div>
                                <div id="evidence-items"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Guided Wizard Results -->
                    <div id="wizard-results" class="d-none mb-4"></div>

                    <!-- Batch Analysis Results -->
                    <div id="batch-results" class="d-none mb-4">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <i class="bi bi-collection"></i> Batch Field Analysis — All Wells
                            </div>
                            <div class="card-body" id="batch-body"></div>
                        </div>
                    </div>

                    <!-- Safety Check Results -->
                    <div id="safety-results" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-shield-exclamation"></i> Prediction Safety Check</div>
                            <div class="card-body">
                                <div id="safety-decision" class="alert mb-3"></div>
                                <div id="safety-blockers"></div>
                                <div id="safety-warnings"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Field Consistency Results -->
                    <div id="field-results" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-globe2"></i> Field-Scale Consistency</div>
                            <div class="card-body">
                                <div id="field-rec" class="alert mb-3"></div>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <h6 class="small fw-bold">SHmax Consistency</h6>
                                        <div id="field-shmax"></div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="small fw-bold">Fracture Type Similarity</h6>
                                        <div id="field-types"></div>
                                    </div>
                                </div>
                                <h6 class="small fw-bold">Per-Well Results</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm small">
                                        <thead><tr><th>Well</th><th>SHmax</th><th>σ1</th><th>σ3</th><th>Misfit</th><th>Fractures</th></tr></thead>
                                        <tbody id="field-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Sufficiency Results -->
                    <div id="suff-results" class="d-none">
                        <h5 class="mb-3"><i class="bi bi-clipboard-check"></i> Data Sufficiency Assessment</h5>
                        <div id="suff-overall" class="alert mb-3"></div>
                        <div class="table-responsive mb-3">
                            <table class="table table-sm">
                                <thead><tr><th>Analysis</th><th>Status</th><th>Assessment</th><th>Min Data Needed</th></tr></thead>
                                <tbody id="suff-table-body"></tbody>
                            </table>
                        </div>
                        <div id="suff-recs"></div>
                    </div>
                </div>

                <!-- DATA TAB -->
                <div id="tab-data" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Data Overview</strong> &mdash; Summary statistics of all fracture measurements loaded from borehole image logs. Check fracture counts, depth ranges, and orientation distributions before running any analysis.</div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-label">Total Fractures</div>
                                <div class="metric-value" id="total-fractures">--</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-label">Wells</div>
                                <div class="metric-value" id="total-wells">--</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-label">Fracture Types</div>
                                <div class="metric-value" id="total-types">--</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-label">Data Source</div>
                                <div class="metric-value" id="data-source-label">Demo</div>
                            </div>
                        </div>
                    </div>
                    <!-- Data Quality Banner -->
                    <div id="quality-banner" class="d-none mb-4">
                        <div class="card" id="quality-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-shield-check"></i> Data Quality Assessment</span>
                                <span class="badge fs-6" id="quality-grade-badge">--</span>
                            </div>
                            <div class="card-body">
                                <div class="d-flex align-items-center gap-3 mb-2">
                                    <div class="fs-4 fw-bold" id="quality-score">--</div>
                                    <div class="flex-grow-1">
                                        <div class="progress" style="height:8px">
                                            <div class="progress-bar" id="quality-bar" style="width:0%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div id="quality-issues"></div>
                                <div id="quality-warnings"></div>
                                <div id="quality-recommendations"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Anomaly Detection -->
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-warning btn-sm" onclick="runMLAnomalyDetection()">
                            <i class="bi bi-robot"></i> ML Anomaly Detection
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="runDataValidation()">
                            <i class="bi bi-clipboard-check"></i> Validate Data Quality
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="runCacheWarmup()">
                            <i class="bi bi-lightning-charge"></i> Warm Caches (Speed Up)
                        </button>
                    </div>
                    <!-- Data Validation Results -->
                    <div id="dv-results" class="d-none mb-4">
                        <div id="dv-brief" class="mb-2"></div>
                        <div class="row g-2 mb-3">
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Quality</div><div class="metric-value" id="dv-quality">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Critical Issues</div><div class="metric-value" id="dv-critical">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Warnings</div><div class="metric-value" id="dv-warnings">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Samples</div><div class="metric-value" id="dv-samples">--</div></div></div>
                        </div>
                        <div class="card"><div class="card-header py-1"><i class="bi bi-exclamation-triangle"></i> Issues & Recommendations</div>
                            <div class="card-body p-0" style="max-height:300px;overflow-y:auto">
                                <table class="table table-sm table-hover mb-0">
                                    <thead class="table-light"><tr><th>Severity</th><th>Field</th><th>Detail</th></tr></thead>
                                    <tbody id="dv-issues-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="anomaly-results" class="d-none mb-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <i class="bi bi-exclamation-triangle"></i> AI Anomaly Detection (Isolation Forest + Mahalanobis)
                            </div>
                            <div class="card-body">
                                <div id="anom-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Anomalies</div><div class="metric-value" id="anom-count">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Rate</div><div class="metric-value" id="anom-rate">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Samples</div><div class="metric-value" id="anom-total">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Maha Threshold</div><div class="metric-value" id="anom-threshold">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="anom-plot-img"></div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-bug"></i> Flagged Measurements (top 50)</div>
                                    <div class="card-body p-0" style="max-height:300px;overflow-y:auto">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light sticky-top"><tr><th>#</th><th>Depth</th><th>Az</th><th>Dip</th><th>Type</th><th>ISO Score</th><th>Mahalanobis</th><th>Unusual Features</th></tr></thead>
                                            <tbody id="anom-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Auto-Analysis Overview -->
                    <div id="overview-panel" class="d-none mb-4">
                        <div class="card border-dark">
                            <div class="card-header bg-dark text-white">
                                <i class="bi bi-speedometer2"></i> Quick Analysis Overview
                                <button class="btn btn-sm btn-outline-light float-end" onclick="runOverview()">
                                    <i class="bi bi-arrow-clockwise"></i> Refresh
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="row g-3 text-center">
                                    <div class="col"><div class="metric-card"><div class="metric-label">SHmax Direction <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Direction of maximum horizontal stress. Determines optimal drilling direction and hydraulic fracture propagation."></i></div><div class="metric-value" id="ov-shmax">--</div></div></div>
                                    <div class="col"><div class="metric-card"><div class="metric-label">Stress Regime <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Auto-detected faulting regime (normal, strike-slip, or thrust) based on best fit to fracture data."></i></div><div class="metric-value" id="ov-regime">--</div></div></div>
                                    <div class="col"><div class="metric-card"><div class="metric-label">Critically Stressed <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Percentage of fractures above the Mohr-Coulomb failure line. These fractures may act as fluid conduits and could reactivate during operations."></i></div><div class="metric-value" id="ov-cs">--</div></div></div>
                                    <div class="col"><div class="metric-card"><div class="metric-label">Risk Level <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Overall operational risk based on critically stressed fractures, data quality, model confidence, and sensitivity analysis."></i></div><div class="metric-value" id="ov-risk">--</div></div></div>
                                    <div class="col"><div class="metric-card"><div class="metric-label">Data Quality <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Grade A-F based on sample size, completeness, value ranges, and consistency of the fracture measurement data."></i></div><div class="metric-value" id="ov-quality">--</div></div></div>
                                    <div class="col"><div class="metric-card"><div class="metric-label">Decision <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="GO: Proceed with operations. CONDITIONAL: Proceed with additional monitoring. NO-GO: Do not proceed without further data or analysis."></i></div><div class="metric-value" id="ov-gonogo">--</div></div></div>
                                </div>
                                <!-- Stakeholder Brief -->
                                <div id="ov-brief" class="d-none mt-3"></div>
                                <!-- Warnings & Disclaimers -->
                                <div id="ov-warnings" class="mt-3"></div>
                            </div>
                        </div>
                    </div>

                    <!-- One-Click Comprehensive Report -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-file-earmark-medical"></i> Comprehensive Analysis Report</span>
                            <div>
                                <button class="btn btn-sm btn-warning me-2" onclick="runComprehensiveReport()">
                                    <i class="bi bi-lightning-fill"></i> Generate Full Report
                                </button>
                                <button class="btn btn-sm btn-outline-light" onclick="downloadPdfReport()">
                                    <i class="bi bi-file-earmark-pdf"></i> Download PDF
                                </button>
                            </div>
                        </div>
                        <div id="cr-results" class="d-none">
                            <div class="card-body">
                                <!-- Verdict banner -->
                                <div id="cr-verdict" class="alert mb-3 text-center">
                                    <h4 id="cr-verdict-label" class="fw-bold mb-1">--</h4>
                                    <div id="cr-signal-summary" class="small"></div>
                                </div>

                                <!-- Executive brief -->
                                <div class="card mb-3">
                                    <div class="card-header"><i class="bi bi-chat-square-text"></i> Executive Brief</div>
                                    <div class="card-body" id="cr-brief" style="white-space:pre-wrap;"></div>
                                </div>

                                <!-- Module summary cards -->
                                <div class="row g-3 mb-3" id="cr-modules"></div>

                                <!-- Errors if any -->
                                <div id="cr-errors" class="d-none"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Geological Context -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-globe-americas"></i> Geological Context &amp; Well Comparison</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runGeologicalContext()">
                                <i class="bi bi-play-fill"></i> Analyze
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Identifies fracture sets, infers tectonic regime, analyzes depth zones, and compares geology across wells. Helps stakeholders understand the geological setting before trusting model outputs.</p>
                            <div id="gc-results" class="d-none">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Wells Analyzed</div><div class="metric-value" id="gc-n-wells">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Regime</div><div class="metric-value" id="gc-regime">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Risk Level</div><div class="metric-value" id="gc-risk">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Cross-Well</div><div class="metric-value" id="gc-crosswell">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="gc-brief"></div>
                                <div class="row g-3 mb-3">
                                    <div class="col-12">
                                        <h6>Fracture Sets per Well</h6>
                                        <div class="table-responsive"><table class="table table-sm table-hover"><thead><tr><th>Well</th><th>Set</th><th>Count</th><th>Mean Azimuth</th><th>Mean Dip</th><th>Interpretation</th></tr></thead><tbody id="gc-sets-body"></tbody></table></div>
                                    </div>
                                </div>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <h6>Depth Zones</h6>
                                        <div class="table-responsive"><table class="table table-sm table-hover"><thead><tr><th>Well</th><th>Zone</th><th>Depth Range</th><th>Count</th><th>Mean Az</th><th>Mean Dip</th></tr></thead><tbody id="gc-zones-body"></tbody></table></div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Type Distribution</h6>
                                        <div class="table-responsive"><table class="table table-sm table-hover"><thead><tr><th>Well</th><th>Type</th><th>Count</th></tr></thead><tbody id="gc-types-body"></tbody></table></div>
                                    </div>
                                </div>
                                <div id="gc-comparison" class="d-none">
                                    <h6>Cross-Well Comparison</h6>
                                    <div class="alert alert-info small" id="gc-comp-text"></div>
                                </div>
                                <div class="text-center"><img id="gc-plot" class="img-fluid" style="max-width:900px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Collection Planner -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-clipboard2-data"></i> Data Collection Planner</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runCollectionPlanner()">
                                <i class="bi bi-play-fill"></i> Analyze Gaps
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Identifies class imbalance gaps, depth coverage holes, and estimates accuracy gain from collecting more data. Provides prioritized actions for field teams.</p>
                            <div id="cp-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Priority Actions</div><div class="metric-value" id="cp-n-actions">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Current Accuracy</div><div class="metric-value" id="cp-current-acc">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Projected (2x data)</div><div class="metric-value" id="cp-projected-acc">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Risk</div><div class="metric-value" id="cp-risk">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="cp-brief"></div>
                                <h6>Class Balance Gaps</h6>
                                <div class="table-responsive mb-3">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light"><tr><th>Well</th><th>Class</th><th>Current</th><th>Target</th><th>Gap</th><th>Priority</th><th>Action</th></tr></thead>
                                        <tbody id="cp-class-body"></tbody>
                                    </table>
                                </div>
                                <h6>Depth Coverage</h6>
                                <div class="table-responsive mb-3">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light"><tr><th>Well</th><th>Depth Range</th><th>Count</th><th>Density %</th><th>Status</th></tr></thead>
                                        <tbody id="cp-depth-body"></tbody>
                                    </table>
                                </div>
                                <div id="cp-priorities" class="d-none">
                                    <h6>Prioritized Actions</h6>
                                    <ul id="cp-priority-list" class="small"></ul>
                                </div>
                                <div class="text-center"><img id="cp-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Cross-Well Drift Detection -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-triangle-fill"></i> Cross-Well Feature Drift</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runDriftDetection()">
                                <i class="bi bi-play-fill"></i> Detect Drift
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Compares feature distributions between wells using Kolmogorov-Smirnov test. Detects distribution shifts that would cause model degradation. Critical for production monitoring.</p>
                            <div id="drift-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Alert Level</div><div class="metric-value" id="drift-alert">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Max Drift</div><div class="metric-value" id="drift-max">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Retrain?</div><div class="metric-value" id="drift-retrain">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Wells</div><div class="metric-value" id="drift-wells">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="drift-brief"></div>
                                <h6>Top Drifted Features</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Wells</th><th>Feature</th><th>KS Stat</th><th>p-value</th><th>Severity</th></tr></thead><tbody id="drift-table-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="drift-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Domain Adaptation -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-arrow-left-right"></i> Well-to-Well Domain Adaptation</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runDomainAdapt()">
                                <i class="bi bi-play-fill"></i> Adapt
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Applies importance reweighting and feature selection to improve cross-well transfer. Tests 3 adaptation strategies and recommends the best approach.</p>
                            <div id="da-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Method</div><div class="metric-value" id="da-best">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="da-improve">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Train Well</div><div class="metric-value" id="da-train">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Test Well</div><div class="metric-value" id="da-test">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="da-brief"></div>
                                <h6>Adaptation Methods Comparison</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Method</th><th>Accuracy</th><th>F1</th><th>Description</th></tr></thead><tbody id="da-methods-body"></tbody></table>
                                </div>
                                <h6>Per-Class Results (Best Method)</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Precision</th><th>Recall</th><th>Support</th></tr></thead><tbody id="da-class-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="da-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Depth-Stratified Cross-Validation -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-layers"></i> Depth-Stratified Validation</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runDepthStratCV()">
                                <i class="bi bi-play-fill"></i> Validate
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Tests model on unseen depth zones (leave-one-zone-out). The most realistic evaluation for oil industry deployment — random splits overestimate performance.</p>
                            <div id="dscv-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Overall Accuracy</div><div class="metric-value" id="dscv-acc">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">vs Random Baseline</div><div class="metric-value" id="dscv-baseline">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Deployment Risk</div><div class="metric-value" id="dscv-risk">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Worst Zone</div><div class="metric-value" id="dscv-worst">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="dscv-brief"></div>
                                <h6>Performance by Depth Zone</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Zone</th><th>Depth Range</th><th>Accuracy</th><th>F1</th><th>Random</th><th>Gap</th><th>Grade</th></tr></thead><tbody id="dscv-zone-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="dscv-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Probability Calibration -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-thermometer-half"></i> Probability Calibration</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runCalibProb()">
                                <i class="bi bi-play-fill"></i> Calibrate
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Temperature scaling ensures "80% confident" actually means correct 80% of the time. Reports ECE (Expected Calibration Error) before and after calibration.</p>
                            <div id="tcal-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Temperature</div><div class="metric-value" id="tcal-temp">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">ECE Before</div><div class="metric-value" id="tcal-before">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">ECE After</div><div class="metric-value" id="tcal-after">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Grade</div><div class="metric-value" id="tcal-grade">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="tcal-brief"></div>
                                <h6>Per-Class Calibration</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Before Conf</th><th>After Conf</th><th>Actual Freq</th><th>Before Gap</th><th>After Gap</th></tr></thead><tbody id="tcal-class-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="tcal-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Feature Interactions -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-diagram-3"></i> Feature Interaction Discovery</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runFeatInteract()">
                                <i class="bi bi-play-fill"></i> Discover
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Beyond single-feature importance: discovers which feature PAIRS synergize or are redundant. In geostress, Dip x Azimuth interactions are physically meaningful.</p>
                            <div id="fi-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Synergistic</div><div class="metric-value" id="fi-syn">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Redundant</div><div class="metric-value" id="fi-red">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Independent</div><div class="metric-value" id="fi-ind">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Strongest</div><div class="metric-value" id="fi-strong">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="fi-brief"></div>
                                <h6>Top Feature Pair Interactions</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Feature A</th><th>Feature B</th><th>Strength</th><th>Type</th><th>Joint Drop</th></tr></thead><tbody id="fi-table-body"></tbody></table>
                                </div>
                                <div id="fi-notes" class="small text-muted mb-2"></div>
                                <div class="text-center"><img id="fi-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Augmentation Analysis -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-plus-circle"></i> Data Augmentation Analysis</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runAugmentation()">
                                <i class="bi bi-play-fill"></i> Analyze
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Tests SMOTE, random oversampling, and undersampling to improve recognition of rare fracture types. Addresses class imbalance where minority classes are under-represented.</p>
                            <div id="aug-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Strategy</div><div class="metric-value" id="aug-best">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="aug-improve">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Imbalance Ratio</div><div class="metric-value" id="aug-ratio">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Minority Class</div><div class="metric-value" id="aug-minority">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="aug-brief"></div>
                                <h6>Strategy Comparison</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Strategy</th><th>Accuracy</th><th>F1</th><th>Balanced Acc</th></tr></thead><tbody id="aug-strat-body"></tbody></table>
                                </div>
                                <h6>Per-Class Improvement</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Count</th><th>Baseline F1</th><th>Best F1</th><th>Gain</th><th>Best Strategy</th></tr></thead><tbody id="aug-class-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="aug-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Multi-Objective Optimization -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-bullseye"></i> Multi-Objective Optimization</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runMultiObj()">
                                <i class="bi bi-play-fill"></i> Optimize
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Pareto frontier analysis balancing accuracy, safety, and coverage. In the oil industry, you cannot just optimize accuracy - you must balance multiple objectives simultaneously.</p>
                            <div id="mo-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Pareto Points</div><div class="metric-value" id="mo-pareto">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Recommended Acc</div><div class="metric-value" id="mo-acc">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Coverage</div><div class="metric-value" id="mo-cov">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Error Rate</div><div class="metric-value" id="mo-err">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="mo-brief"></div>
                                <h6>Operating Scenarios</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Scenario</th><th>Threshold</th><th>Accuracy</th><th>Coverage</th><th>Error Rate</th><th>Classified</th></tr></thead><tbody id="mo-scen-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="mo-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Explainability Report -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-chat-text"></i> Explainability Report</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runExplainReport()">
                                <i class="bi bi-play-fill"></i> Explain
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Plain-English explanations of WHY each prediction was made. For stakeholders who do not understand ML - converts feature contributions into readable narratives.</p>
                            <div id="expl-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Explained</div><div class="metric-value" id="expl-count">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Correct</div><div class="metric-value" id="expl-correct">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Misclassified</div><div class="metric-value" id="expl-wrong">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Avg Confidence</div><div class="metric-value" id="expl-conf">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="expl-brief"></div>
                                <h6>Sample Explanations</h6>
                                <div id="expl-narratives" class="mb-2"></div>
                                <h6>Global Feature Ranking</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Feature</th><th>Importance</th></tr></thead><tbody id="expl-feat-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="expl-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- RLHF Reward Model -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-trophy"></i> RLHF Reward Model Training</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runRewardTrain()">
                                <i class="bi bi-play-fill"></i> Train
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Trains a Bradley-Terry reward model from expert preferences. Learns which predictions experts prefer and uses reward signal to improve the classifier.</p>
                            <div id="rw-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">RLHF Accuracy</div><div class="metric-value" id="rw-acc">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="rw-improve">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Pair Accuracy</div><div class="metric-value" id="rw-pair">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Reward Separation</div><div class="metric-value" id="rw-sep">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="rw-brief"></div>
                                <h6>Reward Features</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Feature</th><th>Reward Weight</th></tr></thead><tbody id="rw-feat-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="rw-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Negative Outcome Learning -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-diamond"></i> Negative Outcome Learning</span>
                            <button class="btn btn-sm btn-outline-dark" onclick="runNegLearn()">
                                <i class="bi bi-play-fill"></i> Learn
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Learns from wrong predictions: weights misclassified samples higher in training. Identifies hard examples that consistently fool the model.</p>
                            <div id="nl-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Hard Examples</div><div class="metric-value" id="nl-hard">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="nl-improve">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Fixed</div><div class="metric-value" id="nl-fixed">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Still Wrong</div><div class="metric-value" id="nl-still">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="nl-brief"></div>
                                <h6>Per-Class Hard Example Analysis</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Count</th><th>Hard</th><th>Hard%</th><th>Base F1</th><th>Neg F1</th><th>Change</th></tr></thead><tbody id="nl-class-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="nl-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Production Monitoring Simulation -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-activity"></i> Production Monitoring Simulation</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runMonitorSim()">
                                <i class="bi bi-play-fill"></i> Simulate
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Simulates real deployment: trains on early data, monitors as new samples arrive. Detects accuracy drift, triggers alerts when performance degrades.</p>
                            <div id="ms-results" class="d-none">
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Monitoring Acc</div><div class="metric-value" id="ms-acc">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Trend</div><div class="metric-value" id="ms-trend">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Alerts</div><div class="metric-value" id="ms-alerts">-</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Retrain?</div><div class="metric-value" id="ms-retrain">-</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="ms-brief"></div>
                                <h6>Batch Performance</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Batch</th><th>Depth Range</th><th>Samples</th><th>Accuracy</th><th>Cumulative</th><th>Status</th></tr></thead><tbody id="ms-batch-body"></tbody></table>
                                </div>
                                <div id="ms-alert-list" class="mb-2"></div>
                                <div class="text-center"><img id="ms-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- v3.25.0: Sample Quality Scoring -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-shield-check"></i> Per-Sample Data Quality</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runSampleQuality()">
                                <i class="bi bi-play-fill"></i> Score Quality
                            </button>
                        </div>
                        <div class="card-body d-none" id="sq-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Clean</div><div class="metric-value text-success" id="sq-clean">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Minor</div><div class="metric-value text-warning" id="sq-minor">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Warning</div><div class="metric-value text-orange" id="sq-warning">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Critical</div><div class="metric-value text-danger" id="sq-critical">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Quality %</div><div class="metric-value" id="sq-quality">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Samples</div><div class="metric-value" id="sq-n">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="sq-brief"></div>
                            <h6>Flag Types</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Flag Type</th><th>Count</th></tr></thead><tbody id="sq-flag-body"></tbody></table>
                            </div>
                            <h6>Top Flagged Samples</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Depth</th><th>Az</th><th>Dip</th><th>Score</th><th>Grade</th><th>Flags</th></tr></thead><tbody id="sq-sample-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="sq-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.25.0: Learning Curve Projection -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-graph-up-arrow"></i> Learning Curve Projection</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runLearningProj()">
                                <i class="bi bi-play-fill"></i> Project
                            </button>
                        </div>
                        <div class="card-body d-none" id="lcp-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Current Acc</div><div class="metric-value" id="lcp-acc">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Asymptote</div><div class="metric-value" id="lcp-asymptote">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Gap</div><div class="metric-value" id="lcp-gap">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">ROI Grade</div><div class="metric-value" id="lcp-roi">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Fit OK?</div><div class="metric-value" id="lcp-fit">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">90% Target</div><div class="metric-value" id="lcp-target">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="lcp-brief"></div>
                            <h6>Projections</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Multiplier</th><th>Samples</th><th>Projected Acc</th><th>Gain</th></tr></thead><tbody id="lcp-proj-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="lcp-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.25.0: Consensus Ensemble -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-people-fill"></i> Consensus Ensemble (Multi-Model Vote)</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runConsensusEnsemble()">
                                <i class="bi bi-play-fill"></i> Run Consensus
                            </button>
                        </div>
                        <div class="card-body d-none" id="ce-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Models</div><div class="metric-value" id="ce-models">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Accepted</div><div class="metric-value text-success" id="ce-accepted">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Rejected</div><div class="metric-value text-danger" id="ce-rejected">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Consensus Rate</div><div class="metric-value" id="ce-rate">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Accepted Acc</div><div class="metric-value" id="ce-acc">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Threshold</div><div class="metric-value" id="ce-thresh">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="ce-brief"></div>
                            <h6>Model Rankings</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Model</th><th>Accuracy</th></tr></thead><tbody id="ce-model-body"></tbody></table>
                            </div>
                            <h6>Per-Class Consensus</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Count</th><th>Consensus Rate</th><th>Accuracy</th><th>Avg Agreement</th></tr></thead><tbody id="ce-class-body"></tbody></table>
                            </div>
                            <h6>Rejected Samples (for Expert Review)</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Depth</th><th>True Class</th><th>Max Agreement</th><th>Vote Distribution</th></tr></thead><tbody id="ce-reject-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="ce-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.26.0: Batch Prediction -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-lightning-charge-fill"></i> Batch Prediction (All Models)</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runBatchPredict()">
                                <i class="bi bi-play-fill"></i> Batch Predict
                            </button>
                        </div>
                        <div class="card-body d-none" id="bp-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Models</div><div class="metric-value" id="bp-models">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Predicted</div><div class="metric-value" id="bp-n">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Accuracy</div><div class="metric-value" id="bp-acc">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">High Conf</div><div class="metric-value text-success" id="bp-high">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Low Conf</div><div class="metric-value text-warning" id="bp-low">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Time</div><div class="metric-value" id="bp-time">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="bp-brief"></div>
                            <h6>Model Summary</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Model</th><th>Accuracy</th><th>Time (s)</th></tr></thead><tbody id="bp-model-body"></tbody></table>
                            </div>
                            <h6>Sample Predictions</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Depth</th><th>True</th><th>Predicted</th><th>Agree</th><th>Votes</th></tr></thead><tbody id="bp-pred-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="bp-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.26.0: Model Selection Advisor -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-award-fill"></i> Model Selection Advisor</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runModelAdvisor()">
                                <i class="bi bi-play-fill"></i> Advise
                            </button>
                        </div>
                        <div class="card-body d-none" id="ma-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Recommended</div><div class="metric-value" id="ma-best">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Balanced Acc</div><div class="metric-value" id="ma-bal">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Models Tested</div><div class="metric-value" id="ma-n">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Classes</div><div class="metric-value" id="ma-classes">-</div></div></div>
                            </div>
                            <div class="alert alert-info border small" id="ma-rationale"></div>
                            <div class="alert alert-light border small" id="ma-brief"></div>
                            <h6>Model Evaluations</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Model</th><th>Accuracy</th><th>Balanced</th><th>F1</th><th>Time</th><th>Stability</th><th>Overfit</th></tr></thead><tbody id="ma-eval-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="ma-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.26.0: Operational Readiness -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-clipboard2-check-fill"></i> Operational Readiness Assessment</span>
                            <button class="btn btn-sm btn-outline-dark" onclick="runOperationalReadiness()">
                                <i class="bi bi-play-fill"></i> Assess
                            </button>
                        </div>
                        <div class="card-body d-none" id="or-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Status</div><div class="metric-value" id="or-status">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Score</div><div class="metric-value" id="or-score">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Passed</div><div class="metric-value text-success" id="or-pass">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Warnings</div><div class="metric-value text-warning" id="or-warn">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Failures</div><div class="metric-value text-danger" id="or-fail">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Best Model</div><div class="metric-value" id="or-model">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="or-brief"></div>
                            <h6>Readiness Checks</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Check</th><th>Grade</th><th>Detail</th><th>Threshold</th></tr></thead><tbody id="or-check-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="or-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.27.0: Geomechanical Feature Enrichment -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-geo-alt-fill"></i> Geomechanical Feature Enrichment (2026 Research)</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runGeomechFeatures()">
                                <i class="bi bi-play-fill"></i> Enrich
                            </button>
                        </div>
                        <div class="card-body d-none" id="gf-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Features Added</div><div class="metric-value" id="gf-n">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Avg Delta</div><div class="metric-value" id="gf-delta">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Models Improved</div><div class="metric-value" id="gf-improved">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Crit. Stressed</div><div class="metric-value text-danger" id="gf-crit">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">SHmax</div><div class="metric-value" id="gf-shmax">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">R-ratio</div><div class="metric-value" id="gf-ratio">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="gf-brief"></div>
                            <h6>Model Comparisons</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Model</th><th>Baseline</th><th>+ Geomech</th><th>Delta</th><th>Improved?</th></tr></thead><tbody id="gf-comp-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="gf-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.27.0: RLHF Iterative Loop -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-arrow-repeat"></i> RLHF Iterative Feedback Loop</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runRlhfIterate()">
                                <i class="bi bi-play-fill"></i> Iterate
                            </button>
                        </div>
                        <div class="card-body d-none" id="ri-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Baseline</div><div class="metric-value" id="ri-base">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Final</div><div class="metric-value" id="ri-final">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="ri-gain">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Iterations</div><div class="metric-value" id="ri-n">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Converged?</div><div class="metric-value" id="ri-conv">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Conv. Iter</div><div class="metric-value" id="ri-citer">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="ri-brief"></div>
                            <h6>Iteration History</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Iter</th><th>Accuracy</th><th>vs Prev</th><th>Total</th><th>Errors</th><th>Pairs</th></tr></thead><tbody id="ri-iter-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="ri-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.27.0: Domain Shift Robustness -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-layers-fill"></i> Domain Shift Robustness (Cross-Zone)</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runDomainShift()">
                                <i class="bi bi-play-fill"></i> Test Shift
                            </button>
                        </div>
                        <div class="card-body d-none" id="ds-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Zones</div><div class="metric-value" id="ds-zones">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Same-Domain</div><div class="metric-value text-success" id="ds-same">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Cross-Domain</div><div class="metric-value text-danger" id="ds-cross">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Domain Gap</div><div class="metric-value" id="ds-gap">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Samples</div><div class="metric-value" id="ds-n">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="ds-brief"></div>
                            <h6>Zone Summary</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Zone</th><th>Depth Range</th><th>Samples</th><th>Self Acc</th><th>Transfer Acc</th><th>Gap</th></tr></thead><tbody id="ds-zone-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="ds-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.28.0: Decision Support Matrix -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-signpost-2-fill"></i> Decision Support Matrix (GO/CAUTION/STOP)</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runDecisionSupport()">
                                <i class="bi bi-play-fill"></i> Decide
                            </button>
                        </div>
                        <div class="card-body d-none" id="dsx-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Decision</div><div class="metric-value" id="dsx-decision">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Score</div><div class="metric-value" id="dsx-score">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Model</div><div class="metric-value" id="dsx-model">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Accuracy</div><div class="metric-value" id="dsx-acc">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="dsx-brief"></div>
                            <h6>Criteria Scores</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Criterion</th><th>Score</th><th>Weight</th><th>Detail</th></tr></thead><tbody id="dsx-crit-body"></tbody></table>
                            </div>
                            <h6>Recommendations</h6>
                            <ul id="dsx-recs" class="small"></ul>
                            <div class="text-center"><img id="dsx-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.28.0: Risk Communication Report -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-diamond-fill"></i> Risk Communication Report (Plain English)</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runRiskReport()">
                                <i class="bi bi-play-fill"></i> Generate Report
                            </button>
                        </div>
                        <div class="card-body d-none" id="rr-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Overall Risk</div><div class="metric-value" id="rr-risk">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">High Risks</div><div class="metric-value text-danger" id="rr-high">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Medium Risks</div><div class="metric-value text-warning" id="rr-med">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Low Risks</div><div class="metric-value text-success" id="rr-low">-</div></div></div>
                            </div>
                            <div class="alert alert-info border" id="rr-exec"></div>
                            <div id="rr-risks"></div>
                            <div class="text-center"><img id="rr-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.28.0: Model Transparency Audit -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-eye-fill"></i> Model Transparency Audit</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runTransparencyAudit()">
                                <i class="bi bi-play-fill"></i> Audit
                            </button>
                        </div>
                        <div class="card-body d-none" id="ta-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Audited</div><div class="metric-value" id="ta-n">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Correct</div><div class="metric-value text-success" id="ta-correct">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Wrong</div><div class="metric-value text-danger" id="ta-wrong">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Accuracy</div><div class="metric-value" id="ta-acc">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Models</div><div class="metric-value" id="ta-models">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="ta-brief"></div>
                            <h6>Top Global Features</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Feature</th><th>Importance</th></tr></thead><tbody id="ta-feat-body"></tbody></table>
                            </div>
                            <h6>Sample Transparency Cards</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Depth</th><th>True</th><th>Predicted</th><th>Agreement</th><th>Geology</th></tr></thead><tbody id="ta-card-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="ta-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.29.0: Conformal Prediction -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-shield-check"></i> Conformal Prediction (Calibrated Uncertainty)</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runConformalPredict()">
                                <i class="bi bi-play-fill"></i> Run
                            </button>
                        </div>
                        <div class="card-body d-none" id="cp-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Target</div><div class="metric-value" id="cp-target">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Coverage</div><div class="metric-value text-success" id="cp-coverage">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Avg Set Size</div><div class="metric-value" id="cp-setsize">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Singletons</div><div class="metric-value text-info" id="cp-singletons">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Model</div><div class="metric-value" id="cp-model">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="cp-brief"></div>
                            <h6>Prediction Sets (Test Samples)</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Depth</th><th>True</th><th>Point Prediction</th><th>Conformal Set</th><th>Size</th><th>Covered?</th></tr></thead><tbody id="cp-table-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="cp-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.29.0: Physics-Consistency Validation -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-gear-wide-connected"></i> Physics-Consistency Validation</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runPhysicsConsistency()">
                                <i class="bi bi-play-fill"></i> Validate
                            </button>
                        </div>
                        <div class="card-body d-none" id="pc-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Consistency</div><div class="metric-value" id="pc-level">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Score</div><div class="metric-value" id="pc-score">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Violations</div><div class="metric-value text-danger" id="pc-violations">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">SHmax</div><div class="metric-value" id="pc-shmax">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">CS Rate</div><div class="metric-value" id="pc-csrate">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="pc-brief"></div>
                            <h6>Physics Checks</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Check</th><th>Score</th><th>Detail</th></tr></thead><tbody id="pc-check-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="pc-plot" class="img-fluid" style="max-width:800px" /></div>
                        </div>
                    </div>

                    <!-- v3.29.0: Active Learning Strategy -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-graph-up-arrow"></i> Active Learning Strategy</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runActiveLearning()">
                                <i class="bi bi-play-fill"></i> Analyze
                            </button>
                        </div>
                        <div class="card-body d-none" id="al-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Suggested</div><div class="metric-value" id="al-n">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Current Acc</div><div class="metric-value" id="al-acc">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Projected Gain</div><div class="metric-value text-success" id="al-gain">-</div></div></div>
                                <div class="col-md-2"><div class="metric-card"><div class="metric-label">Worth It?</div><div class="metric-value" id="al-worth">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Strategy</div><div class="metric-value" id="al-strategy">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="al-brief"></div>
                            <h6>Priority Samples for Expert Labeling</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Depth</th><th>Prediction</th><th>Confidence</th><th>Disagreement</th><th>Why Selected</th></tr></thead><tbody id="al-table-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="al-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.30.0: Model Leaderboard -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-trophy-fill"></i> Model Performance Leaderboard</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runModelLeaderboard()">
                                <i class="bi bi-play-fill"></i> Compare
                            </button>
                        </div>
                        <div class="card-body d-none" id="lb-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Model</div><div class="metric-value" id="lb-best">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Accuracy</div><div class="metric-value text-success" id="lb-acc">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Models Tested</div><div class="metric-value" id="lb-count">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Weak Class</div><div class="metric-value text-warning" id="lb-weak">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="lb-brief"></div>
                            <h6>Leaderboard</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Model</th><th>Bal. Accuracy</th><th>Mean F1</th><th>Worst Class</th><th>Worst F1</th></tr></thead><tbody id="lb-table-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="lb-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.30.0: Data Augmentation Advisor -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-database-fill-gear"></i> Data Augmentation Advisor</span>
                            <button class="btn btn-sm btn-outline-dark" onclick="runAugmentationAdvisor()">
                                <i class="bi bi-play-fill"></i> Analyze
                            </button>
                        </div>
                        <div class="card-body d-none" id="da-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Undersampled</div><div class="metric-value text-danger" id="da-under">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Depth Gaps</div><div class="metric-value text-warning" id="da-gaps">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">SMOTE Gain</div><div class="metric-value" id="da-smote">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Actions</div><div class="metric-value" id="da-actions">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="da-brief"></div>
                            <h6>Recommendations</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Priority</th><th>Category</th><th>Action</th><th>Impact</th></tr></thead><tbody id="da-rec-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="da-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.31.0: BMA Ensemble -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-layers-fill"></i> Bayesian Model Averaging</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runBMAEnsemble()">
                                <i class="bi bi-play-fill"></i> Run BMA
                            </button>
                        </div>
                        <div class="card-body d-none" id="bma-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">BMA Accuracy</div><div class="metric-value text-info" id="bma-acc">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Single</div><div class="metric-value text-secondary" id="bma-best">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="bma-improvement">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Calibration (ECE)</div><div class="metric-value" id="bma-ece">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="bma-brief"></div>
                            <h6>Model Weights</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Model</th><th>Weight</th><th>Accuracy</th><th>Contribution</th></tr></thead><tbody id="bma-weights-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="bma-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.31.0: Misclassification Analysis -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-bug-fill"></i> Misclassification Analysis</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runMisclassAnalysis()">
                                <i class="bi bi-play-fill"></i> Analyze Errors
                            </button>
                        </div>
                        <div class="card-body d-none" id="misclass-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Misclassified</div><div class="metric-value text-danger" id="misclass-count">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Error Rate</div><div class="metric-value text-warning" id="misclass-rate">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Confident Errors</div><div class="metric-value text-danger" id="misclass-confident">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Worst Class</div><div class="metric-value" id="misclass-worst">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="misclass-brief"></div>
                            <h6>Confusion Pairs</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>True</th><th>Predicted As</th><th>Count</th><th>Rate</th><th>Severity</th></tr></thead><tbody id="misclass-pairs-body"></tbody></table>
                            </div>
                            <h6>Per-Class Error Analysis</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Samples</th><th>Errors</th><th>Error Rate</th><th>Status</th><th>Geological Reason</th></tr></thead><tbody id="misclass-class-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="misclass-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.31.0: Expert Feedback Loop -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-person-check-fill"></i> Expert Feedback Loop (RLHF)</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runExpertRetrain()">
                                <i class="bi bi-arrow-repeat"></i> Retrain
                            </button>
                        </div>
                        <div class="card-body d-none" id="feedback-results">
                            <div class="mb-3">
                                <p class="small text-muted">Submit expert corrections as JSON: <code>[{"index": 0, "corrected_class": "Continuous", "reason": "Visible on image log"}]</code></p>
                                <textarea class="form-control font-monospace small mb-2" id="feedback-input" rows="3" placeholder='[{"index": 0, "corrected_class": "Continuous", "reason": "Expert review"}]'></textarea>
                                <button class="btn btn-sm btn-success" onclick="submitFeedback()"><i class="bi bi-send-fill"></i> Submit Corrections</button>
                                <span class="small text-muted ms-2" id="feedback-status"></span>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Original Accuracy</div><div class="metric-value text-secondary" id="fb-orig">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Corrected Accuracy</div><div class="metric-value text-success" id="fb-corr">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="fb-improvement">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Corrections Applied</div><div class="metric-value" id="fb-applied">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="fb-brief"></div>
                            <div class="text-center"><img id="fb-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.31.0: Wellbore Stability -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-cone-striped"></i> Wellbore Stability Assessment</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runWellboreStability()">
                                <i class="bi bi-play-fill"></i> Assess
                            </button>
                        </div>
                        <div class="card-body d-none" id="wb-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Mud Weight Window</div><div class="metric-value" id="wb-window">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Stress Regime</div><div class="metric-value" id="wb-regime">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Critical Fractures</div><div class="metric-value text-danger" id="wb-critical">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Window Status</div><div class="metric-value" id="wb-status">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="wb-brief"></div>
                            <h6>Recommendations</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Priority</th><th>Category</th><th>Action</th><th>Impact</th></tr></thead><tbody id="wb-rec-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="wb-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.32.0: Cross-Well Transfer -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-arrow-left-right"></i> Cross-Well Transfer Validation</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runCrossWellTransfer()">
                                <i class="bi bi-play-fill"></i> Test Transfer
                            </button>
                        </div>
                        <div class="card-body d-none" id="transfer-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Transfer Accuracy</div><div class="metric-value text-primary" id="xfer-acc">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Baseline</div><div class="metric-value text-secondary" id="xfer-base">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Degradation</div><div class="metric-value" id="xfer-degrad">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Transfer Safe?</div><div class="metric-value" id="xfer-safe">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="xfer-brief"></div>
                            <div class="text-center"><img id="xfer-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.32.0: Prediction Reliability -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-shield-fill-check"></i> Prediction Reliability Scoring</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runReliabilityScoring()">
                                <i class="bi bi-play-fill"></i> Score
                            </button>
                        </div>
                        <div class="card-body d-none" id="reliability-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Mean Score</div><div class="metric-value" id="rel-mean">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">GREEN</div><div class="metric-value text-success" id="rel-green">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">AMBER</div><div class="metric-value text-warning" id="rel-amber">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">RED</div><div class="metric-value text-danger" id="rel-red">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="rel-brief"></div>
                            <div class="text-center"><img id="rel-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.32.0: Executive Dashboard -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-speedometer2"></i> Executive Decision Dashboard</span>
                            <button class="btn btn-sm btn-outline-light" onclick="runExecutiveDashboard()">
                                <i class="bi bi-play-fill"></i> Generate
                            </button>
                        </div>
                        <div class="card-body d-none" id="exec-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Overall Confidence</div><div class="metric-value" id="exec-confidence">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Model Grade</div><div class="metric-value" id="exec-model-grade">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Data Grade</div><div class="metric-value" id="exec-data-grade">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Accuracy</div><div class="metric-value" id="exec-best-acc">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="exec-brief"></div>
                            <h6>Key Risks</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Severity</th><th>Risk</th><th>Mitigation</th></tr></thead><tbody id="exec-risks-body"></tbody></table>
                            </div>
                            <h6>Prioritized Actions</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Action</th><th>Detail</th><th>Timeline</th></tr></thead><tbody id="exec-actions-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="exec-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.33.0: Deployment Readiness Checklist -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-clipboard-check"></i> Field Deployment Readiness</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runDeploymentReadiness()">
                                <i class="bi bi-play-fill"></i> Run Checklist
                            </button>
                        </div>
                        <div class="card-body d-none" id="deploy-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Decision</div><div class="metric-value" id="deploy-decision">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Checks Passed</div><div class="metric-value" id="deploy-passed">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Checks Failed</div><div class="metric-value" id="deploy-failed">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Total Checks</div><div class="metric-value" id="deploy-total">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="deploy-brief"></div>
                            <h6>Checklist Details</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Status</th><th>Check</th><th>Requirement</th><th>Actual</th><th>Category</th></tr></thead><tbody id="deploy-checks-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="deploy-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.33.0: Sensitivity Analysis -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-activity"></i> Sensitivity Analysis</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runSensitivityAnalysis()">
                                <i class="bi bi-play-fill"></i> Analyze
                            </button>
                        </div>
                        <div class="card-body d-none" id="sens-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Mean Flip Rate</div><div class="metric-value" id="sens-flip-rate">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Stable</div><div class="metric-value text-success" id="sens-stable">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Moderate</div><div class="metric-value text-warning" id="sens-moderate">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Sensitive</div><div class="metric-value text-danger" id="sens-sensitive">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="sens-brief"></div>
                            <h6>Per-Class Sensitivity</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Predictions</th><th>Mean Flip Rate</th><th>Stability</th><th>Highly Sensitive</th><th>Level</th></tr></thead><tbody id="sens-class-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="sens-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.34.0: Model Monitoring -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-graph-up-arrow"></i> Model Monitoring & Drift Detection</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runModelMonitoring()">
                                <i class="bi bi-play-fill"></i> Monitor
                            </button>
                        </div>
                        <div class="card-body d-none" id="monitor-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Drift Status</div><div class="metric-value" id="monitor-status">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Avg PSI</div><div class="metric-value" id="monitor-psi">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">High Drift Features</div><div class="metric-value" id="monitor-high">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Model Accuracy</div><div class="metric-value" id="monitor-acc">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="monitor-brief"></div>
                            <h6>Feature Drift</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Feature</th><th>PSI</th><th>Severity</th><th>Ref Mean</th><th>New Mean</th><th>Shift</th></tr></thead><tbody id="monitor-features-body"></tbody></table>
                            </div>
                            <h6>Class Distribution Shift</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Ref %</th><th>New %</th><th>Shift %</th><th>Severity</th></tr></thead><tbody id="monitor-class-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="monitor-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.34.0: Formation Boundaries -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-layers"></i> Formation Boundary Detection</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runFormationBoundaries()">
                                <i class="bi bi-play-fill"></i> Detect
                            </button>
                        </div>
                        <div class="card-body d-none" id="formation-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Boundaries Found</div><div class="metric-value" id="formation-count">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Segments</div><div class="metric-value" id="formation-segments">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Depth Range</div><div class="metric-value" id="formation-depth">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Fractures</div><div class="metric-value" id="formation-fractures">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="formation-brief"></div>
                            <h6>Detected Boundaries</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Depth (m)</th><th>Confidence</th><th>Z-Score</th><th>Signals</th><th>Dip Change</th></tr></thead><tbody id="formation-boundaries-body"></tbody></table>
                            </div>
                            <h6>Formation Segments</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Top (m)</th><th>Bottom (m)</th><th>Thickness</th><th>Fractures</th><th>Mean Dip</th><th>Dominant Type</th><th>Density</th></tr></thead><tbody id="formation-segments-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="formation-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.34.0: Full Report -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-file-earmark-text"></i> Comprehensive Analysis Report</span>
                            <button class="btn btn-sm btn-outline-light" onclick="runFullReport()">
                                <i class="bi bi-play-fill"></i> Generate Report
                            </button>
                        </div>
                        <div class="card-body d-none" id="report-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Overall Assessment</div><div class="metric-value" id="report-assessment">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Model</div><div class="metric-value" id="report-model">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Accuracy</div><div class="metric-value" id="report-accuracy">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Risks</div><div class="metric-value" id="report-risks">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="report-brief"></div>
                            <h6>Risks</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Severity</th><th>Risk</th><th>Detail</th><th>Mitigation</th></tr></thead><tbody id="report-risks-body"></tbody></table>
                            </div>
                            <h6>Recommended Actions</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>#</th><th>Action</th><th>Detail</th><th>Timeline</th></tr></thead><tbody id="report-actions-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="report-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.35.0: Fracture Connectivity -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-diagram-3"></i> Fracture Network Connectivity</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runFractureConnectivity()">
                                <i class="bi bi-play-fill"></i> Analyze
                            </button>
                        </div>
                        <div class="card-body d-none" id="conn-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Network Quality</div><div class="metric-value" id="conn-quality">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Fracture Sets</div><div class="metric-value" id="conn-sets">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Flow Azimuth</div><div class="metric-value" id="conn-flow">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Anisotropy</div><div class="metric-value" id="conn-aniso">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="conn-brief"></div>
                            <h6>Fracture Sets</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Set</th><th>Count</th><th>%</th><th>Azimuth</th><th>Dip</th><th>Spacing</th><th>Dominant Type</th></tr></thead><tbody id="conn-sets-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="conn-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.35.0: Failure Prediction -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-triangle"></i> Wellbore Failure Prediction</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runFailurePrediction()">
                                <i class="bi bi-play-fill"></i> Predict
                            </button>
                        </div>
                        <div class="card-body d-none" id="failure-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">High Risk Zones</div><div class="metric-value text-danger" id="failure-high">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Medium Risk</div><div class="metric-value text-warning" id="failure-med">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">MW Window</div><div class="metric-value" id="failure-mw">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Risk Zones</div><div class="metric-value" id="failure-zones">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="failure-brief"></div>
                            <div class="text-center"><img id="failure-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.35.0: Batch Analysis -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-collection"></i> Batch Multi-Well Analysis</span>
                            <button class="btn btn-sm btn-outline-light" onclick="runBatchAnalysis()">
                                <i class="bi bi-play-fill"></i> Run All Wells
                            </button>
                        </div>
                        <div class="card-body d-none" id="batch-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Wells Analyzed</div><div class="metric-value" id="batch-wells">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Total Samples</div><div class="metric-value" id="batch-samples">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Avg Accuracy</div><div class="metric-value" id="batch-avg">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Well</div><div class="metric-value" id="batch-best">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="batch-brief"></div>
                            <h6>Well Comparison</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Well</th><th>Samples</th><th>Best Model</th><th>Accuracy</th><th>Data Quality</th><th>Model Quality</th></tr></thead><tbody id="batch-wells-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="batch-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.36.0: Uncertainty Zonation -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-map"></i> Uncertainty-Aware Zonation</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="runUncertaintyZonation()">
                                <i class="bi bi-play-fill"></i> Zone
                            </button>
                        </div>
                        <div class="card-body d-none" id="zone-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Confident</div><div class="metric-value text-success" id="zone-confident">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Uncertain</div><div class="metric-value text-warning" id="zone-uncertain">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Unreliable</div><div class="metric-value text-danger" id="zone-unreliable">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Depth Zones</div><div class="metric-value" id="zone-count">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="zone-brief"></div>
                            <div class="text-center"><img id="zone-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.36.0: Aperture-Permeability -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-droplet-half"></i> Fracture Aperture & Permeability</span>
                            <button class="btn btn-sm btn-outline-info" onclick="runAperturePermeability()">
                                <i class="bi bi-play-fill"></i> Estimate
                            </button>
                        </div>
                        <div class="card-body d-none" id="aperture-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Mean Aperture</div><div class="metric-value" id="aperture-mean">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Bulk Perm</div><div class="metric-value" id="aperture-perm">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Max Aperture</div><div class="metric-value" id="aperture-max">-</div></div></div>
                                <div class="col-md-3"><div class="metric-card"><div class="metric-label">Fractures</div><div class="metric-value" id="aperture-count">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="aperture-brief"></div>
                            <h6>Aperture by Fracture Type</h6>
                            <div class="table-responsive mb-2">
                                <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Type</th><th>Count</th><th>Mean Aperture</th><th>Mean Perm (D)</th><th>Multiplier</th></tr></thead><tbody id="aperture-class-body"></tbody></table>
                            </div>
                            <div class="text-center"><img id="aperture-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.36.0: Well Correlation -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-arrow-left-right"></i> Well Correlation Analysis</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runWellCorrelation()">
                                <i class="bi bi-play-fill"></i> Compare
                            </button>
                        </div>
                        <div class="card-body d-none" id="corr-results">
                            <div class="row g-2 mb-3">
                                <div class="col-md-4"><div class="metric-card"><div class="metric-label">Wells Compared</div><div class="metric-value" id="corr-wells">-</div></div></div>
                                <div class="col-md-4"><div class="metric-card"><div class="metric-label">Best Correlation</div><div class="metric-value" id="corr-best">-</div></div></div>
                                <div class="col-md-4"><div class="metric-card"><div class="metric-label">Correlation Level</div><div class="metric-value" id="corr-level">-</div></div></div>
                            </div>
                            <div class="alert alert-light border small" id="corr-brief"></div>
                            <div class="text-center"><img id="corr-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.37.0: Terzaghi Correction -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-bullseye"></i> Terzaghi Sampling Bias Correction</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runTerzaghiCorrection()">
                                <i class="bi bi-play-fill"></i> Analyze Bias
                            </button>
                        </div>
                        <div class="card-body" id="terzaghi-results" style="display:none">
                            <div class="row mb-2" id="terzaghi-metrics"></div>
                            <div class="alert alert-light border small" id="terzaghi-brief"></div>
                            <div class="text-center"><img id="terzaghi-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.37.0: Effective Stress Profile -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-arrow-down-up"></i> Effective Stress Profile (Biot)</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="runEffectiveStress()">
                                <i class="bi bi-play-fill"></i> Compute Profile
                            </button>
                        </div>
                        <div class="card-body" id="effstress-results" style="display:none">
                            <div class="row mb-2" id="effstress-metrics"></div>
                            <div class="alert alert-light border small" id="effstress-brief"></div>
                            <div class="text-center"><img id="effstress-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.37.0: Decision Intelligence -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-shield-check"></i> Decision Intelligence Dashboard</span>
                            <button class="btn btn-sm btn-outline-success" onclick="runDecisionIntelligence()">
                                <i class="bi bi-play-fill"></i> Generate Report
                            </button>
                        </div>
                        <div class="card-body" id="decintel-results" style="display:none">
                            <div class="row mb-2" id="decintel-metrics"></div>
                            <div id="decintel-risk-matrix"></div>
                            <div id="decintel-glossary" style="display:none"></div>
                            <div class="alert alert-light border small" id="decintel-brief"></div>
                            <div class="text-center"><img id="decintel-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- v3.37.0: Accuracy Feedback Loop -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-arrow-repeat"></i> Accuracy Feedback Loop</span>
                            <button class="btn btn-sm btn-outline-warning" onclick="loadAccuracyTrend()">
                                <i class="bi bi-graph-up"></i> View Trend
                            </button>
                        </div>
                        <div class="card-body" id="feedback-results" style="display:none">
                            <div class="row mb-2" id="feedback-metrics"></div>
                            <div id="feedback-form" class="mb-3">
                                <h6>Submit Field Outcome</h6>
                                <div class="row g-2">
                                    <div class="col-md-3"><input type="number" class="form-control form-control-sm" id="fb-depth" placeholder="Depth (m)" /></div>
                                    <div class="col-md-3"><input type="text" class="form-control form-control-sm" id="fb-predicted" placeholder="Predicted type" /></div>
                                    <div class="col-md-3"><input type="text" class="form-control form-control-sm" id="fb-actual" placeholder="Actual type" /></div>
                                    <div class="col-md-3"><button class="btn btn-sm btn-warning w-100" onclick="submitOutcome()">Submit</button></div>
                                </div>
                            </div>
                            <div class="alert alert-light border small" id="feedback-brief"></div>
                        </div>
                    </div>

                    <!-- v3.37.0: Failure-Aware Classification -->
                    <div class="card mb-4 border-dark">
                        <div class="card-header bg-dark bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-diamond-fill"></i> Failure-Aware Classification</span>
                            <button class="btn btn-sm btn-outline-dark" onclick="runFailureAwareClassification()">
                                <i class="bi bi-play-fill"></i> Run Analysis
                            </button>
                        </div>
                        <div class="card-body" id="failaware-results" style="display:none">
                            <div class="row mb-2" id="failaware-metrics"></div>
                            <div class="alert alert-light border small" id="failaware-brief"></div>
                            <div class="text-center"><img id="failaware-plot" class="img-fluid" style="max-width:900px" /></div>
                        </div>
                    </div>

                    <!-- Persistent Storage Management -->
                    <div class="card mb-4 border-secondary">
                        <div class="card-header bg-secondary bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-database-fill-check"></i> Persistent Storage (SQLite)</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="loadDbStats()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="db-stats" class="row g-2 mb-3">
                                <div class="col-4">
                                    <div class="text-center p-2 bg-light rounded">
                                        <div class="fs-4 fw-bold text-primary" id="db-audit-count">-</div>
                                        <small class="text-muted">Audit Records</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center p-2 bg-light rounded">
                                        <div class="fs-4 fw-bold text-success" id="db-model-count">-</div>
                                        <small class="text-muted">Model Runs</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center p-2 bg-light rounded">
                                        <div class="fs-4 fw-bold text-warning" id="db-pref-count">-</div>
                                        <small class="text-muted">Expert Prefs</small>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="exportDatabase()">
                                    <i class="bi bi-download"></i> Export Backup
                                </button>
                                <label class="btn btn-sm btn-outline-success mb-0">
                                    <i class="bi bi-upload"></i> Import Backup
                                    <input type="file" accept=".json" onchange="importDatabase(event)" hidden>
                                </label>
                                <small class="text-muted align-self-center ms-auto" id="db-size">-</small>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Navigation for Stakeholders -->
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info bg-opacity-10">
                            <i class="bi bi-signpost-split"></i> Analysis Workflow
                        </div>
                        <div class="card-body">
                            <div class="row g-2 text-center">
                                <div class="col">
                                    <a href="#" data-tab="viz" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-pie-chart fs-4 d-block text-primary"></i>
                                        <small>1. Visualize</small></div>
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="#" data-tab="inversion" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-gear-wide-connected fs-4 d-block text-primary"></i>
                                        <small>2. Stress Inversion</small></div>
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="#" data-tab="models" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-bar-chart-line fs-4 d-block text-primary"></i>
                                        <small>3. Compare Models</small></div>
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="#" data-tab="sensitivity" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-sliders fs-4 d-block text-primary"></i>
                                        <small>4. Sensitivity</small></div>
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="#" data-tab="risk" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-shield-exclamation fs-4 d-block text-danger"></i>
                                        <small>5. Risk Matrix</small></div>
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="#" data-tab="uncertainty" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-clipboard-pulse fs-4 d-block text-info"></i>
                                        <small>6. Uncertainty</small></div>
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="#" data-tab="report" class="nav-link text-decoration-none">
                                        <div class="p-2 rounded bg-light"><i class="bi bi-file-earmark-text fs-4 d-block text-success"></i>
                                        <small>7. Report</small></div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Fracture Summary by Well & Type</div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0" id="summary-table">
                                    <thead>
                                        <tr>
                                            <th>Well</th><th>Fracture Type</th><th>Count</th>
                                            <th>Depth Min (m)</th><th>Depth Max (m)</th>
                                            <th>Mean Azimuth (&deg;)</th><th>Mean Dip (&deg;)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Data Contribution Tracker -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-graph-up-arrow"></i> Data Contribution Tracker</h5>
                    <p class="text-muted small">Shows exactly where more data is needed and how much accuracy would improve. Tells your field team what to collect.</p>

                    <button class="btn btn-info btn-sm mb-3" onclick="runDataTracker()">
                        <i class="bi bi-bullseye"></i> Analyze Data Gaps
                    </button>

                    <div id="dt-results" class="d-none">
                        <!-- Data Health Grade -->
                        <div class="card mb-3" id="dt-health-card">
                            <div class="card-body text-center py-3">
                                <div class="small text-muted">DATA HEALTH</div>
                                <h2 id="dt-health-grade" class="fw-bold mb-1">--</h2>
                                <p id="dt-health-summary" class="mb-0"></p>
                            </div>
                        </div>

                        <!-- Per-Class Sample Analysis -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-collection"></i> Fracture Type Sample Analysis</div>
                            <div class="card-body p-0">
                                <table class="table table-sm table-striped mb-0">
                                    <thead><tr>
                                        <th>Fracture Type</th><th>Current</th><th>Target</th><th>Deficit</th><th>Priority</th>
                                    </tr></thead>
                                    <tbody id="dt-class-tbody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Depth Coverage -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-layers"></i> Depth Zone Coverage</div>
                            <div class="card-body p-0">
                                <table class="table table-sm table-striped mb-0">
                                    <thead><tr>
                                        <th>Depth Zone</th><th>Samples</th><th>Coverage %</th><th>Priority</th>
                                    </tr></thead>
                                    <tbody id="dt-depth-tbody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Accuracy Projections -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-graph-up"></i> Accuracy Projections</div>
                            <div class="card-body">
                                <div class="mb-2">Current accuracy: <strong id="dt-current-acc">--</strong></div>
                                <div id="dt-projections"></div>
                            </div>
                        </div>

                        <!-- Recommendations -->
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white"><i class="bi bi-signpost-split"></i> Collection Recommendations</div>
                            <div class="card-body" id="dt-recommendations"></div>
                        </div>
                    </div>
                </div>

                <!-- VISUALIZATIONS TAB -->
                <div id="tab-viz" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Visualizations</strong> &mdash; Visual plots showing fracture orientation patterns. <em>Rose diagrams</em> show which compass directions fractures face (like a wind rose). <em>Stereonets</em> project 3D orientations onto a 2D circle. <em>Depth profiles</em> show how fractures change with depth.</div>
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="loadAllViz()">
                            <i class="bi bi-play-fill"></i> Generate All
                        </button>
                    </div>
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Rose Diagram</div>
                                <div class="card-body text-center">
                                    <img id="rose-img" class="plot-img" alt="Click Generate All">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Stereonet</div>
                                <div class="card-body text-center">
                                    <img id="stereonet-img" class="plot-img" alt="Click Generate All">
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">Depth Profile</div>
                                <div class="card-body text-center">
                                    <img id="depth-img" class="plot-img" alt="Click Generate All">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INVERSION TAB (Enhanced) -->
                <div id="tab-inversion" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Stress Inversion</strong> &mdash; The core analysis: estimates underground stress magnitudes and directions from fracture orientations. <strong>Key output:</strong> SHmax (maximum horizontal stress direction) determines optimal drilling direction. The Mohr circle shows which fractures are close to failure.</div>
                    <div class="d-flex gap-2 mb-3 flex-wrap">
                        <button class="btn btn-primary btn-sm" onclick="runInversion()">
                            <i class="bi bi-play-fill"></i> Run Inversion
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="runAllRegimes()">
                            <i class="bi bi-arrow-repeat"></i> Compare All Regimes
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="runBayesian()">
                            <i class="bi bi-distribute-vertical"></i> Bayesian Uncertainty
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="exportInversion()">
                            <i class="bi bi-download"></i> Export Results (CSV)
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="exportData()">
                            <i class="bi bi-filetype-csv"></i> Export Raw Data
                        </button>
                    </div>

                    <!-- Auto Regime Detection Banner -->
                    <div id="auto-regime-banner" class="d-none mb-4">
                        <div class="card border-success">
                            <div class="card-header bg-success bg-opacity-10">
                                <i class="bi bi-robot"></i> Automatic Regime Detection
                                <span class="badge ms-2" id="auto-regime-confidence"></span>
                            </div>
                            <div class="card-body">
                                <p id="auto-regime-summary" class="mb-3"></p>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped mb-0" id="auto-regime-table">
                                        <thead><tr>
                                            <th>Regime</th><th>Misfit</th>
                                            <th>&sigma;1</th><th>&sigma;3</th>
                                            <th>R</th><th>SHmax</th><th>&mu;</th>
                                            <th></th>
                                        </tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bayesian MCMC Results -->
                    <div id="bayesian-results" class="d-none mb-4">
                        <div class="card border-info">
                            <div class="card-header bg-info bg-opacity-10">
                                <i class="bi bi-distribute-vertical"></i> Bayesian MCMC Uncertainty Bounds
                                <span class="badge bg-info ms-2" id="bayes-convergence"></span>
                            </div>
                            <div class="card-body">
                                <p class="small text-muted" id="bayes-summary"></p>
                                <div id="bayes-params-body"></div>
                                <div class="mt-2 small text-muted" id="bayes-meta"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Results metrics -->
                    <div id="inversion-results" class="d-none">
                        <!-- Stakeholder Brief — plain-English decision summary -->
                        <div id="inv-brief" class="d-none mb-4"></div>
                        <div class="mb-2"><span id="inv-quality-badge" class="badge bg-secondary">Data: --</span> <span id="inv-ci-hint" class="badge bg-light text-muted border small">Point estimates &mdash; click <em>Bayesian Uncertainty</em> for &plusmn;error bars</span></div>
                        <div class="row g-3 mb-4">
                            <div class="col-md-2"><div class="metric-card"><div class="metric-label">&sigma;1 (MPa) <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Maximum principal stress. The largest compressive stress in the rock mass. Higher values indicate deeper or more compressed rock."></i></div><div class="metric-value" id="inv-sigma1">--</div></div></div>
                            <div class="col-md-2"><div class="metric-card"><div class="metric-label">&sigma;2 (MPa) <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Intermediate principal stress. Derived from &sigma;1, &sigma;3, and R ratio."></i></div><div class="metric-value" id="inv-sigma2">--</div></div></div>
                            <div class="col-md-2"><div class="metric-card"><div class="metric-label">&sigma;3 (MPa) <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Minimum principal stress. The least compressive stress. Fractures tend to open perpendicular to this direction."></i></div><div class="metric-value" id="inv-sigma3">--</div></div></div>
                            <div class="col-md-2"><div class="metric-card"><div class="metric-label">R Ratio <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Stress shape ratio: (&sigma;2-&sigma;3)/(&sigma;1-&sigma;3). Range 0-1. R near 0 means &sigma;2&asymp;&sigma;3 (prolate stress); R near 1 means &sigma;1&asymp;&sigma;2 (oblate stress)."></i></div><div class="metric-value" id="inv-R">--</div></div></div>
                            <div class="col-md-2"><div class="metric-card"><div class="metric-label">SHmax (&deg;) <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Maximum horizontal stress direction (degrees from North). CRITICAL FOR DRILLING: Wells drilled parallel to SHmax are most stable. Hydraulic fractures propagate along SHmax."></i></div><div class="metric-value" id="inv-shmax">--</div></div></div>
                            <div class="col-md-2"><div class="metric-card"><div class="metric-label">Pore Pressure <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Fluid pressure in rock pores (MPa). Reduces effective normal stress on fractures, making them more likely to slip. Higher Pp = more critically stressed fractures."></i></div><div class="metric-value" id="inv-pp">--</div></div></div>
                        </div>

                        <!-- Uncertainty Confidence Intervals -->
                        <div id="inv-uncertainty" class="d-none mb-4"></div>

                        <!-- WSM Quality Ranking -->
                        <div id="inv-wsm-quality" class="d-none mb-4"></div>

                        <!-- Calibration Warning -->
                        <div id="inv-calibration-warning" class="d-none mb-4"></div>

                        <!-- Multi-Criteria CS% -->
                        <div id="inv-multi-criteria" class="d-none mb-4"></div>

                        <!-- Mud Weight Window -->
                        <div id="inv-mud-weight" class="d-none mb-4"></div>

                        <!-- 1D Stress Profile -->
                        <div id="inv-stress-profile" class="d-none mb-4">
                            <div class="card">
                                <div class="card-header bg-dark text-white">
                                    <i class="bi bi-bar-chart"></i> 1D Stress Profile (Mechanical Earth Model)
                                    <button class="btn btn-sm btn-outline-light float-end" id="btn-load-stress-profile" onclick="loadStressProfile()">
                                        <i class="bi bi-arrow-clockwise"></i> Generate Profile
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted small mb-2">Depth-varying principal stresses: Sv (overburden), SHmax, Shmin, Pp (pore pressure). Standard geomechanics deliverable for drilling engineers.</p>
                                    <div id="stress-profile-content" class="text-center">
                                        <p class="text-muted">Click "Generate Profile" to compute the 1D stress model.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Risk Assessment Banner -->
                        <div id="risk-banner" class="alert mb-4 d-none">
                            <h5 class="alert-heading" id="risk-title"></h5>
                            <div id="risk-body"></div>
                        </div>

                        <!-- Stakeholder Interpretation -->
                        <div id="interpretation-section" class="mb-4 d-none">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <i class="bi bi-lightbulb"></i> Decision Support - What This Means
                                </div>
                                <div class="card-body" id="interpretation-body"></div>
                            </div>
                        </div>

                        <!-- Risk Categories -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="metric-card" style="border-left:4px solid #dc3545">
                                    <div class="metric-label">High Risk Fractures <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Fractures with slip tendency > 0.8. These are very close to failure and may reactivate during drilling or injection. Avoid operations near these fractures."></i></div>
                                    <div class="metric-value text-danger" id="inv-high-risk">--</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="metric-card" style="border-left:4px solid #ffc107">
                                    <div class="metric-label">Moderate Risk <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Fractures with slip tendency 0.6-0.8. These could be reactivated under pressure changes. Monitor during operations and plan contingencies."></i></div>
                                    <div class="metric-value text-warning" id="inv-mod-risk">--</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="metric-card" style="border-left:4px solid #198754">
                                    <div class="metric-label">Low Risk <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Fractures with slip tendency < 0.6. These are relatively stable under current stress conditions. Normal operations are safe."></i></div>
                                    <div class="metric-value text-success" id="inv-low-risk">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Actionable Recommendations -->
                        <div id="inv-recommendations" class="d-none mb-3"></div>

                        <!-- Temperature Correction (2025 Research) -->
                        <div id="inv-thermal" class="d-none mb-3"></div>

                        <div class="row g-3">
                            <div class="col-lg-6">
                                <div class="card"><div class="card-header">Mohr Circle</div>
                                <div class="card-body text-center"><img id="mohr-img" class="plot-img"></div></div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card"><div class="card-header">Slip Tendency</div>
                                <div class="card-body text-center"><img id="slip-img" class="plot-img"></div></div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card"><div class="card-header">Dilation Tendency</div>
                                <div class="card-body text-center"><img id="dilation-img" class="plot-img"></div></div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card"><div class="card-header">Analysis Dashboard</div>
                                <div class="card-body text-center"><img id="dashboard-img" class="plot-img"></div></div>
                            </div>
                        </div>
                    </div>

                    <!-- Regime comparison table -->
                    <div id="regime-comparison" class="d-none mt-4">
                        <div class="card">
                            <div class="card-header">Regime Comparison</div>
                            <div class="card-body p-0">
                                <table class="table table-striped mb-0" id="regime-table">
                                    <thead><tr>
                                        <th>Regime</th><th>&sigma;1</th><th>&sigma;2</th><th>&sigma;3</th>
                                        <th>R</th><th>SHmax</th><th>&mu;</th><th>Crit. Stressed</th>
                                    </tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                    <!-- Pore Pressure Coupling -->
                    <div class="card border-danger mb-3">
                        <div class="card-header bg-danger bg-opacity-10 py-2">
                            <i class="bi bi-droplet-half"></i> <strong>Pore Pressure Coupling</strong>
                            <small class="text-muted ms-2">Formation integrity at varying pressures</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Sweeps pore pressure from 0.3&ndash;0.6 &times; Sv to show how CS% and formation integrity change.
                                Critical for wellbore stability and mud weight decisions.
                            </p>
                            <button class="btn btn-danger btn-sm" onclick="runPorePressureCoupling()">
                                <i class="bi bi-droplet-half"></i> Run Pp Coupling Analysis
                            </button>
                            <div id="pp-results" class="d-none mt-2">
                                <div id="pp-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Current CS%</div><div class="metric-value" id="pp-current-cs">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">FIF Grade</div><div class="metric-value" id="pp-fif-grade">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Sensitivity</div><div class="metric-value" id="pp-sensitivity">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Sv (MPa)</div><div class="metric-value" id="pp-sv">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="pp-plot-img"></div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-table"></i> Pore Pressure Sweep</div>
                                    <div class="card-body p-0" style="max-height:300px;overflow-y:auto">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light sticky-top"><tr><th>Pp/Sv</th><th>Pp (MPa)</th><th>CS%</th><th>FIF</th><th>Grade</th><th>&sigma;1_eff</th><th>&sigma;3_eff</th></tr></thead>
                                            <tbody id="pp-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODEL COMPARISON TAB (NEW) -->
                <div id="tab-models" class="tab-content">
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runModelComparison(false)">
                            <i class="bi bi-play-fill"></i> Full Comparison
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="runModelComparison(true)">
                            <i class="bi bi-lightning"></i> Quick Compare (~3x faster)
                        </button>
                    </div>
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Model Comparison</strong> &mdash; Runs 7 different AI algorithms on the same data and ranks them by accuracy. The best model is recommended automatically. <em>Why multiple models?</em> Different algorithms capture different patterns &mdash; comparing ensures the most reliable one is chosen for your specific data.</div>

                    <div id="model-results" class="d-none">
                        <!-- Stakeholder Brief -->
                        <div id="mc-brief" class="d-none mb-4"></div>
                        <!-- Ranking criterion notice -->
                        <div id="mc-ranking-notice" class="d-none alert alert-info py-2 mb-3 small"></div>
                        <!-- Summary metrics -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Best Model</div>
                                    <div class="metric-value" id="mc-best-model">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Best Accuracy</div>
                                    <div class="metric-value" id="mc-best-acc">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Model Agreement</div>
                                    <div class="metric-value" id="mc-agreement">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card" style="border-left:4px solid #ffc107">
                                    <div class="metric-label">Low Confidence Samples</div>
                                    <div class="metric-value" id="mc-low-conf">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Model agreement explanation -->
                        <div id="mc-uncertainty-alert" class="alert alert-info mb-4 d-none">
                            <i class="bi bi-info-circle"></i>
                            <strong>What does Model Agreement mean?</strong>
                            <span id="mc-uncertainty-text"></span>
                        </div>

                        <!-- Ranking table -->
                        <div class="card mb-4">
                            <div class="card-header">Model Ranking (by Cross-Validated Accuracy)</div>
                            <div class="card-body p-0">
                                <table class="table table-striped mb-0" id="mc-ranking-table">
                                    <thead><tr>
                                        <th>Rank</th><th>Model</th><th>CV Accuracy</th><th>Balanced Acc.</th><th>F1 Score</th><th>Overfit Gap</th>
                                    </tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Conformal confidence -->
                        <div id="mc-conformal-section" class="d-none mb-4">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <i class="bi bi-shield-check"></i> Prediction Confidence (Conformal Calibration)
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">Mean Confidence</div>
                                                <div class="fw-bold fs-5" id="mc-conf-mean">--</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">High Confidence (&ge;80%)</div>
                                                <div class="fw-bold fs-5 text-success" id="mc-conf-high">--</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">Uncertain (&lt;50%)</div>
                                                <div class="fw-bold fs-5 text-danger" id="mc-conf-uncertain">--</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">Min Confidence</div>
                                                <div class="fw-bold fs-5" id="mc-conf-min">--</div>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="small text-muted mt-2 mb-0">
                                        <strong>What this means:</strong> Conformal prediction provides calibrated confidence scores.
                                        Fractures with &lt;50% confidence should be reviewed by an expert before operational decisions.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Generalization Assessment -->
                        <div id="mc-generalization" class="d-none mb-4">
                            <div class="card border-warning">
                                <div class="card-header bg-warning bg-opacity-10">
                                    <i class="bi bi-clipboard-check"></i> Generalization Assessment
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-4">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">Train-Test Gap</div>
                                                <div class="fw-bold fs-5" id="mc-gen-gap">--</div>
                                                <div class="small text-muted">&lt;5% is good</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">CV Stability (std)</div>
                                                <div class="fw-bold fs-5" id="mc-gen-stability">--</div>
                                                <div class="small text-muted">&lt;5% is stable</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="small text-muted">Min Class Size</div>
                                                <div class="fw-bold fs-5" id="mc-gen-min-class">--</div>
                                                <div class="small text-muted">&ge;30 for reliable metrics</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="mc-gen-warnings"></div>
                                </div>
                            </div>
                        </div>

                        <!-- SMOTE Info -->
                        <div id="mc-smote-info" class="d-none alert alert-info py-2 mb-3 small"></div>

                        <!-- Model Comparison Chart -->
                        <div id="mc-chart-container" class="d-none card mb-4">
                            <div class="card-header"><i class="bi bi-bar-chart-fill"></i> Accuracy Comparison Chart</div>
                            <div class="card-body text-center">
                                <img id="mc-chart-img" class="plot-img" src="" alt="Model comparison chart">
                            </div>
                        </div>

                        <!-- Per-model details -->
                        <div id="mc-details-container"></div>
                    </div>

                    <!-- Learning Curve -->
                    <div class="card mt-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-graph-up"></i> Learning Curve — Do We Need More Data?</span>
                            <button class="btn btn-outline-primary btn-sm" onclick="runLearningCurve()">
                                <i class="bi bi-play-fill"></i> Compute
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Shows how model accuracy changes with training set size. If the curve has plateaued, more data of the same type won't help — you need better features or different data sources.</p>
                            <div id="lc-results" class="d-none">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Convergence</div>
                                            <div class="metric-value" id="lc-convergence">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Current Accuracy</div>
                                            <div class="metric-value" id="lc-current-acc">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Total Samples</div>
                                            <div class="metric-value" id="lc-n-samples">--</div>
                                        </div>
                                    </div>
                                </div>
                                <div id="lc-convergence-msg" class="alert alert-info small mb-3"></div>
                                <div id="lc-chart-container" class="d-none text-center mb-3">
                                    <img id="lc-chart-img" class="plot-img" src="" alt="Learning curve chart">
                                </div>
                                <div class="card mb-3">
                                    <div class="card-header">Accuracy vs Training Size</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm mb-0" id="lc-table">
                                            <thead><tr><th>Samples</th><th>Train Acc</th><th>Val Acc</th><th>Balanced Acc</th></tr></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="lc-projections" class="d-none">
                                    <h6>Data Projections</h6>
                                    <div id="lc-projection-list"></div>
                                </div>
                                <div id="lc-per-class" class="d-none">
                                    <h6>Per-Class F1 vs Training Size</h6>
                                    <table class="table table-sm" id="lc-class-table">
                                        <thead><tr id="lc-class-header"></tr></thead>
                                        <tbody id="lc-class-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hierarchical Classification -->
                    <div class="card mt-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-diagram-3"></i> Hierarchical Classification — Better Rare-Type Detection</span>
                            <button class="btn btn-outline-primary btn-sm" onclick="runHierarchical()">
                                <i class="bi bi-play-fill"></i> Run
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Two-level approach: first detects rare vs common fracture types, then sub-classifies. This helps when some fracture types have very few samples (e.g., Boundary: 13 samples).</p>
                            <div id="hier-results" class="d-none">
                                <div id="hier-recommendation" class="alert mb-3"></div>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Approach</div>
                                            <div class="metric-value" id="hier-approach" style="font-size:1rem">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Flat Balanced Acc</div>
                                            <div class="metric-value" id="hier-flat-bal">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Hierarchical Balanced Acc</div>
                                            <div class="metric-value" id="hier-hier-bal">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">L1 (Rare/Common) Acc</div>
                                            <div class="metric-value" id="hier-l1-acc">--</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card mb-3">
                                    <div class="card-header">Per-Class F1 Comparison</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm mb-0" id="hier-class-table">
                                            <thead><tr>
                                                <th>Class</th><th>Samples</th><th>Type</th><th>Flat F1</th><th>Hierarchical F1</th><th>Change</th>
                                            </tr></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Depth-Zone Classification -->
                    <div class="card mt-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-layers"></i> Depth-Zone Classification — Depth-Specific Models</span>
                            <button class="btn btn-outline-primary btn-sm" onclick="runDepthZoneClassify()">
                                <i class="bi bi-play-fill"></i> Run
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Fracture behavior changes with depth (different stress regimes). Trains separate models per depth zone and compares to the global model. May improve accuracy for depth-variable datasets.</p>
                            <div id="depthzone-results" class="d-none"></div>
                        </div>
                    </div>

                    <!-- Bootstrap Confidence Intervals -->
                    <div class="card mt-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-bar-chart-steps"></i> Confidence Intervals — How Reliable Are Predictions?</span>
                            <button class="btn btn-outline-primary btn-sm" onclick="runBootstrapCI()">
                                <i class="bi bi-play-fill"></i> Compute 95% CI
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Bootstrap resampling (200x) to compute 95% confidence intervals for per-class metrics. Industrial-grade: "F1 = 0.85 [0.78 - 0.91]" instead of just "F1 = 0.85".</p>
                            <div id="ci-results" class="d-none">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Reliability</div>
                                            <div class="metric-value" id="ci-reliability">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Accuracy</div>
                                            <div class="metric-value" id="ci-accuracy">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Accuracy CI</div>
                                            <div class="metric-value" id="ci-accuracy-range">--</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-label">Bootstraps</div>
                                            <div class="metric-value" id="ci-n-boot">--</div>
                                        </div>
                                    </div>
                                </div>
                                <div id="ci-reliability-msg" class="alert mb-3 small"></div>
                                <div id="ci-chart-container" class="d-none text-center mb-3">
                                    <img id="ci-chart-img" class="plot-img" src="" alt="Bootstrap CI chart">
                                </div>
                                <div class="card">
                                    <div class="card-header">Per-Class 95% Confidence Intervals</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm mb-0" id="ci-class-table">
                                            <thead><tr>
                                                <th>Class</th><th>F1</th><th>F1 CI</th><th>Precision</th><th>Precision CI</th><th>Recall</th><th>Recall CI</th>
                                            </tr></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SHAP EXPLAINABILITY TAB (NEW) -->
                <div id="tab-shap" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Why It Predicts</strong> &mdash; Shows which fracture features (depth, angle, orientation) most influence the AI classification. SHAP values reveal the &ldquo;reasoning&rdquo; behind each prediction &mdash; critical for trusting AI decisions in operations.</div>
                    <div class="d-flex gap-2 mb-3">
                        <select id="shap-classifier-select" class="form-select form-select-sm" style="width:auto">
                            <option value="gradient_boosting" selected>Gradient Boosting</option>
                            <option value="random_forest">Random Forest</option>
                            <option value="xgboost">XGBoost</option>
                            <option value="lightgbm">LightGBM</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="runShapExplanation()">
                            <i class="bi bi-play-fill"></i> Explain Predictions
                        </button>
                    </div>
                    <p class="text-muted small">
                        Uses SHAP (SHapley Additive exPlanations) to show <strong>why</strong> the model makes its predictions.
                        Each feature gets an importance score based on its actual contribution, not just correlation.
                        This helps stakeholders understand and trust the AI's fracture classifications.
                    </p>

                    <div id="shap-results" class="d-none">
                        <!-- SHAP summary metrics -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Explanation Method</div>
                                    <div class="metric-value" id="shap-method">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Model Used</div>
                                    <div class="metric-value" id="shap-model">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Features Analyzed</div>
                                    <div class="metric-value" id="shap-n-features">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Samples Explained</div>
                                    <div class="metric-value" id="shap-n-samples">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Global feature importance -->
                        <div class="row g-3 mb-4">
                            <div class="col-lg-7">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="bi bi-bar-chart"></i> Global Feature Importance (What Drives Predictions Most)
                                    </div>
                                    <div class="card-body" id="shap-global-container"></div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="bi bi-info-circle"></i> What This Means for Decisions
                                    </div>
                                    <div class="card-body" id="shap-explanation-text">
                                        <p class="text-muted">Run the explanation to see feature importance insights.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Per-class importance -->
                        <div id="shap-class-section" class="d-none mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-diagram-3"></i> What Drives Each Fracture Type Classification
                                </div>
                                <div class="card-body" id="shap-class-container"></div>
                            </div>
                        </div>

                        <!-- Sample explanations -->
                        <div id="shap-sample-section" class="d-none">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-search"></i> Individual Fracture Explanations (Most Distinctive Samples)
                                </div>
                                <div class="card-body" id="shap-sample-container"></div>
                            </div>
                        </div>

                        <!-- SHAP Visualization Plots (Server-rendered) -->
                        <div id="shap-plots-section" class="d-none mt-4">
                            <h5 class="mb-3"><i class="bi bi-graph-up"></i> SHAP Visualization Plots</h5>
                            <div class="row g-3 mb-3">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header bg-dark text-white"><i class="bi bi-bar-chart-fill"></i> Global Feature Importance (SHAP)</div>
                                        <div class="card-body text-center" id="shap-global-plot-img"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-lg-6">
                                    <div class="card">
                                        <div class="card-header"><i class="bi bi-funnel"></i> Waterfall: Most Uncertain Prediction</div>
                                        <div class="card-body text-center" id="shap-waterfall-plot-img"></div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card">
                                        <div class="card-header"><i class="bi bi-scatter-chart"></i> Feature Value vs SHAP Impact</div>
                                        <div class="card-body text-center" id="shap-scatter-plot-img"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="shap-per-class-plots" class="row g-3 mb-3"></div>
                            <div id="shap-plots-brief"></div>
                        </div>
                    </div>
                </div>

                <!-- CLASSIFICATION TAB (Enhanced) -->
                <div id="tab-classify" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>ML Classification</strong> &mdash; Uses machine learning to automatically categorize fractures by type (e.g., continuous, discontinuous, brecciated). Accuracy metrics show how reliable the classification is. Conformal prediction adds calibrated confidence intervals.</div>
                    <div class="d-flex gap-2 mb-3">
                        <select id="classifier-select" class="form-select form-select-sm" style="width:auto">
                            <option value="random_forest">Random Forest</option>
                            <option value="gradient_boosting">Gradient Boosting</option>
                            <option value="xgboost">XGBoost</option>
                            <option value="lightgbm">LightGBM</option>
                            <option value="catboost">CatBoost</option>
                            <option value="svm">SVM</option>
                            <option value="mlp">Neural Network</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="runClassification()">
                            <i class="bi bi-play-fill"></i> Run Classification
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="runDeepEnsemble()">
                            <i class="bi bi-layers-fill"></i> Deep Ensemble UQ
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="runTransferLearning()">
                            <i class="bi bi-arrow-left-right"></i> Transfer Learning
                        </button>
                    </div>
                    <p class="text-muted small">Uses enhanced physics-informed features including pore pressure, overburden stress, temperature, fracture density, and fabric strength.</p>

                    <!-- Deep Ensemble UQ Results -->
                    <div id="ensemble-results" class="d-none mb-3"></div>

                    <!-- Transfer Learning Results -->
                    <div id="transfer-results" class="d-none mb-3"></div>

                    <!-- Domain-Adapted Transfer Learning -->
                    <div class="card border-info mb-3">
                        <div class="card-header bg-info bg-opacity-10 py-2">
                            <i class="bi bi-diagram-3"></i> <strong>Domain-Adapted Transfer</strong>
                            <small class="text-muted ms-2">MMD reweighting + pseudo-labeling</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Compares 5 domain adaptation strategies: zero-shot, fine-tuned, MMD kernel reweighting,
                                progressive pseudo-labeling, and target-only. Also reports feature distribution shifts (Cohen's d).
                            </p>
                            <div class="d-flex gap-2 mb-2 align-items-center">
                                <select id="ta-source-well" class="form-select form-select-sm" style="width:auto">
                                    <option value="3P">Source: 3P</option>
                                    <option value="6P">Source: 6P</option>
                                </select>
                                <i class="bi bi-arrow-right"></i>
                                <select id="ta-target-well" class="form-select form-select-sm" style="width:auto">
                                    <option value="6P">Target: 6P</option>
                                    <option value="3P">Target: 3P</option>
                                </select>
                                <button class="btn btn-info btn-sm" onclick="runTransferAdapted()">
                                    <i class="bi bi-arrow-left-right"></i> Compare Methods
                                </button>
                            </div>
                            <div id="ta-results" class="d-none">
                                <div id="ta-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Method</div><div class="metric-value" id="ta-best-method">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Accuracy</div><div class="metric-value" id="ta-best-acc">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Feature Shifts</div><div class="metric-value" id="ta-n-shifts">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Fine-tune Size</div><div class="metric-value" id="ta-ft-size">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="ta-plot-img"></div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-table"></i> Method Comparison</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Method</th><th>Accuracy</th><th>F1</th><th>Details</th></tr></thead>
                                            <tbody id="ta-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="ta-shifts-section" class="d-none mt-2">
                                    <h6 class="small fw-bold"><i class="bi bi-exclamation-triangle text-warning"></i> Significant Feature Shifts</h6>
                                    <div class="table-responsive" style="max-height:200px;overflow-y:auto">
                                        <table class="table table-sm table-bordered mb-0">
                                            <thead class="table-light"><tr><th>Feature</th><th>Cohen's d</th><th>Severity</th></tr></thead>
                                            <tbody id="ta-shifts-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Balanced Classification (SMOTE) -->
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success bg-opacity-10 py-2">
                            <i class="bi bi-balance-scale"></i> <strong>Class-Balanced Classification</strong>
                            <small class="text-muted ms-2">SMOTE oversampling for minority fracture types</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Compares 4 training strategies to fix poor recall on minority classes (Boundary, Continuous).
                                SMOTE generates synthetic samples; balanced weights penalize majority-class errors.
                            </p>
                            <div class="d-flex gap-2 mb-2">
                                <button class="btn btn-success btn-sm" onclick="runBalancedClassify()">
                                    <i class="bi bi-play-fill"></i> Run Balanced Comparison
                                </button>
                            </div>
                            <div id="bc-results" class="d-none">
                                <div id="bc-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Method</div><div class="metric-value" id="bc-best-method">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Bal.Acc</div><div class="metric-value" id="bc-best-balacc">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Samples</div><div class="metric-value" id="bc-samples">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">SMOTE?</div><div class="metric-value" id="bc-has-smote">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="bc-plot-img"></div>
                                <div class="card mb-2">
                                    <div class="card-header py-1"><i class="bi bi-table"></i> Method Comparison</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Method</th><th>Accuracy</th><th>Balanced Acc</th><th>F1</th></tr></thead>
                                            <tbody id="bc-methods-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-graph-up-arrow"></i> Minority Class Improvements</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Class</th><th>Count</th><th>Baseline Recall</th><th>Best Recall</th><th>Improvement</th></tr></thead>
                                            <tbody id="bc-minority-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Heterogeneous Ensemble -->
                    <div class="card border-dark mb-3">
                        <div class="card-header bg-dark bg-opacity-75 text-white py-2">
                            <i class="bi bi-stack"></i> <strong>Heterogeneous Ensemble</strong>
                            <small class="opacity-75 ms-2">RF + GBM + SVM + LR + MLP meta-learner</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Trains 5 diverse model families and combines them via a meta-learner.
                                Reports ensemble accuracy, per-model contributions, and prediction confidence from model agreement.
                            </p>
                            <button class="btn btn-dark btn-sm" onclick="runHeteroEnsemble()">
                                <i class="bi bi-stack"></i> Build Ensemble
                            </button>
                            <div id="he-results" class="d-none mt-2">
                                <div id="he-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Ensemble Acc</div><div class="metric-value" id="he-acc">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">vs Best Single</div><div class="metric-value" id="he-improvement">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Agreement</div><div class="metric-value" id="he-agreement">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Contested</div><div class="metric-value" id="he-contested">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="he-plot-img"></div>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <div class="card"><div class="card-header py-1"><i class="bi bi-bar-chart"></i> Base Model Accuracies</div>
                                            <div class="card-body p-0"><table class="table table-sm table-hover mb-0">
                                                <thead class="table-light"><tr><th>Model</th><th>CV Accuracy</th><th>Contribution</th></tr></thead>
                                                <tbody id="he-models-body"></tbody>
                                            </table></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Feature Ablation Study -->
                    <div class="card border-warning mb-3">
                        <div class="card-header bg-warning bg-opacity-10 py-2">
                            <i class="bi bi-scissors"></i> <strong>Feature Ablation Study</strong>
                            <small class="text-muted ms-2">Which features matter most?</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Systematically removes feature groups to measure accuracy impact.
                                Groups with large drops are critical; groups with minimal impact may be removed for simplicity.
                            </p>
                            <button class="btn btn-warning btn-sm" onclick="runFeatureAblation()">
                                <i class="bi bi-scissors"></i> Run Ablation
                            </button>
                            <div id="fa-results" class="d-none mt-2">
                                <div id="fa-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Most Critical</div><div class="metric-value" id="fa-most-important">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Baseline Acc</div><div class="metric-value" id="fa-baseline">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Feature Groups</div><div class="metric-value" id="fa-n-groups">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Total Features</div><div class="metric-value" id="fa-n-features">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="fa-plot-img"></div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-table"></i> Ablation Results (sorted by impact)</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Rank</th><th>Group</th><th># Features</th><th>Acc Without</th><th>Acc Drop</th></tr></thead>
                                            <tbody id="fa-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hyperparameter Optimization -->
                    <div class="card border-primary mb-3">
                        <div class="card-header bg-primary bg-opacity-10 py-2">
                            <i class="bi bi-sliders2"></i> <strong>Hyperparameter Optimization</strong>
                            <small class="text-muted ms-2">Find optimal model configuration</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Tests multiple hyperparameter configurations via randomized search.
                                Returns the best params and whether they improve over defaults.
                            </p>
                            <div class="d-flex gap-2 mb-2 align-items-center">
                                <label class="form-label small mb-0">Iterations:</label>
                                <select id="opt-n-iter" class="form-select form-select-sm" style="width:auto">
                                    <option value="10">10 (fast)</option>
                                    <option value="20" selected>20 (standard)</option>
                                    <option value="50">50 (thorough)</option>
                                </select>
                                <button class="btn btn-primary btn-sm" onclick="runOptimizeModel()">
                                    <i class="bi bi-sliders2"></i> Optimize
                                </button>
                            </div>
                            <div id="opt-results" class="d-none mt-2">
                                <div id="opt-brief" class="mb-2"></div>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Default Acc</div><div class="metric-value" id="opt-default">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Acc</div><div class="metric-value" id="opt-best">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="opt-improvement">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Configs Tested</div><div class="metric-value" id="opt-n-iter-val">--</div></div></div>
                                </div>
                                <div class="text-center mb-2" id="opt-plot-img"></div>
                                <div class="card mb-2">
                                    <div class="card-header py-1"><i class="bi bi-gear"></i> Best Parameters</div>
                                    <div class="card-body py-2"><pre id="opt-best-params" class="mb-0 small"></pre></div>
                                </div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-trophy"></i> Top 5 Configurations</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Rank</th><th>Score</th><th>Std</th><th>Parameters</th></tr></thead>
                                            <tbody id="opt-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Model Significance Testing -->
                    <div class="card border-dark mb-3">
                        <div class="card-header bg-dark text-white py-2">
                            <i class="bi bi-graph-up-arrow"></i> <strong>Model Significance Testing</strong>
                            <small class="text-white-50 ms-2">Are differences between models real?</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Runs all classifiers and performs pairwise McNemar's test to determine if accuracy
                                differences are statistically significant (p&lt;0.05). Prevents over-reading noise.
                            </p>
                            <button class="btn btn-dark btn-sm" onclick="runModelSignificance()">
                                <i class="bi bi-calculator"></i> Run Significance Test
                            </button>
                            <div id="msig-results" class="d-none mt-2">
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Model</div><div class="metric-value" id="msig-best">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Accuracy</div><div class="metric-value" id="msig-acc">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Sig. Better Than</div><div class="metric-value" id="msig-sig-count">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Models Tested</div><div class="metric-value" id="msig-n-models">--</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="msig-verdict"></div>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light"><tr><th>Rank</th><th>Model</th><th>Accuracy</th><th>F1</th><th>Balanced Acc</th><th>Time (s)</th></tr></thead>
                                        <tbody id="msig-table-body"></tbody>
                                    </table>
                                </div>
                                <div class="text-center"><img id="msig-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Conformal Prediction -->
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success bg-opacity-10 py-2">
                            <i class="bi bi-shield-check"></i> <strong>Conformal Prediction (Uncertainty-Aware)</strong>
                            <small class="text-muted ms-2">How confident is each prediction?</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Instead of a single class label, returns a SET of possible classes with guaranteed coverage.
                                Smaller sets = higher confidence. Singleton predictions are unambiguous.
                            </p>
                            <button class="btn btn-success btn-sm" onclick="runConformalPredict()">
                                <i class="bi bi-shield-check"></i> Run Conformal Analysis
                            </button>
                            <div id="cf-results" class="d-none mt-2">
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Coverage</div><div class="metric-value" id="cf-coverage">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Avg Set Size</div><div class="metric-value" id="cf-avg-size">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Singleton %</div><div class="metric-value" id="cf-singleton">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Confidence</div><div class="metric-value" id="cf-risk">--</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="cf-brief"></div>
                                <h6>Per-Class Confidence</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Class</th><th>Count</th><th>Avg Set Size</th><th>Singleton %</th><th>Coverage</th><th>Confidence</th></tr></thead><tbody id="cf-class-body"></tbody></table>
                                </div>
                                <h6>Most Uncertain Predictions</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Depth (m)</th><th>True Class</th><th>Prediction Set</th><th>Set Size</th><th>Max Prob</th></tr></thead><tbody id="cf-uncertain-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="cf-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Cross-Well Generalization -->
                    <div class="card border-primary mb-3">
                        <div class="card-header bg-primary bg-opacity-10 py-2">
                            <i class="bi bi-arrow-left-right"></i> <strong>Cross-Well Generalization Test</strong>
                            <small class="text-muted ms-2">Will this model work on a new well?</small>
                        </div>
                        <div class="card-body py-2">
                            <p class="text-muted small mb-2">
                                Trains on well A, tests on well B (and vice versa). This is the real deployment scenario.
                                Within-well CV is optimistic; cross-well accuracy is the true measure of generalization.
                            </p>
                            <button class="btn btn-primary btn-sm" onclick="runCrossWellTest()">
                                <i class="bi bi-arrow-left-right"></i> Run Cross-Well Test
                            </button>
                            <div id="cw-results" class="d-none mt-2">
                                <div class="row g-2 mb-2">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Transfer Grade</div><div class="metric-value fs-3" id="cw-grade">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Within-Well Acc</div><div class="metric-value" id="cw-within">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Cross-Well Acc</div><div class="metric-value" id="cw-cross">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Degradation</div><div class="metric-value" id="cw-degrad">--</div></div></div>
                                </div>
                                <div class="alert alert-light border small" id="cw-brief"></div>
                                <h6>Cross-Well Transfer Results</h6>
                                <div class="table-responsive mb-2">
                                    <table class="table table-sm table-hover"><thead class="table-light"><tr><th>Train</th><th>Test</th><th>Train N</th><th>Test N</th><th>Accuracy</th><th>F1</th><th>Bal. Acc</th></tr></thead><tbody id="cw-table-body"></tbody></table>
                                </div>
                                <div class="text-center"><img id="cw-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <div id="classify-results" class="d-none">
                        <!-- Stakeholder Brief -->
                        <div id="clf-brief" class="d-none mb-4"></div>
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">CV Accuracy</div>
                                    <div class="metric-value" id="clf-accuracy">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Std Deviation</div>
                                    <div class="metric-value" id="clf-std">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">F1 Score</div>
                                    <div class="metric-value" id="clf-f1">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Classifier</div>
                                    <div class="metric-value" id="clf-type">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3">
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">Feature Importances</div>
                                    <div class="card-body" id="feat-imp-container"></div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">Confusion Matrix</div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-bordered mb-0 table-sm" id="confusion-table">
                                                <thead></thead><tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Spatial CV Warning -->
                        <div id="clf-spatial-cv" class="d-none mt-3"></div>
                        <!-- Conformal Prediction -->
                        <div id="clf-conformal" class="d-none mt-3"></div>
                    </div>
                </div>

                <!-- CLUSTERING TAB -->
                <div id="tab-cluster" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Fracture Clustering</strong> &mdash; Groups fractures that share similar orientations into &ldquo;fracture sets.&rdquo; Each set likely formed under the same stress conditions. Knowing fracture sets helps predict reservoir connectivity and fluid flow paths.</div>
                    <div class="d-flex gap-2 mb-3">
                        <select id="n-clusters-select" class="form-select form-select-sm" style="width:auto">
                            <option value="auto">Auto-detect</option>
                            <option value="2">2 clusters</option>
                            <option value="3">3 clusters</option>
                            <option value="4">4 clusters</option>
                            <option value="5">5 clusters</option>
                            <option value="6">6 clusters</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="runClustering()">
                            <i class="bi bi-play-fill"></i> Run Clustering
                        </button>
                    </div>
                    <div id="cluster-results" class="d-none">
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <div class="metric-card">
                                    <div class="metric-label">Fracture Sets Found</div>
                                    <div class="metric-value" id="n-clusters-val">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3">
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">Cluster Stereonet</div>
                                    <div class="card-body text-center">
                                        <img id="cluster-img" class="plot-img">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">Cluster Statistics</div>
                                    <div class="card-body p-0">
                                        <table class="table table-striped mb-0 table-sm" id="cluster-stats-table">
                                            <thead><tr><th>Set</th><th>Mean Az</th><th>Mean Dip</th><th>Count</th></tr></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FEEDBACK TAB (NEW) -->
                <div id="tab-feedback" class="tab-content">
                    <div class="alert alert-light border py-2 mb-3 small"><i class="bi bi-info-circle text-primary"></i> <strong>Feedback Loop</strong> &mdash; Tell the AI when its predictions are wrong. Each correction improves future accuracy. The trust score shows how much confidence to place in the model based on data quality and correction history.</div>

                    <!-- Trust Score Banner -->
                    <div class="card mb-4 border-0 shadow-sm" id="trust-score-card">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="mb-1"><i class="bi bi-shield-check"></i> Model Trust Score</h5>
                                    <p class="text-muted small mb-0">Composite confidence metric combining expert feedback, calibration, data quality, corrections, and sample size.</p>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" onclick="runTrustScore()">
                                    <i class="bi bi-arrow-clockwise"></i> Compute
                                </button>
                            </div>
                            <div id="trust-score-body">
                                <p class="text-muted small">Click "Compute" to assess overall model trustworthiness. The trust score updates as you submit feedback and corrections.</p>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="bi bi-chat-dots"></i> Submit Feedback</div>
                                <div class="card-body">
                                    <p class="text-muted small">Help improve GeoStress AI by rating analysis accuracy. Your feedback trains future model versions.</p>
                                    <div class="mb-3">
                                        <label class="form-label">Analysis Type</label>
                                        <select id="fb-type" class="form-select form-select-sm">
                                            <option value="inversion">Stress Inversion</option>
                                            <option value="classification">Fracture Classification</option>
                                            <option value="clustering">Fracture Clustering</option>
                                            <option value="critically_stressed">Critically Stressed Analysis</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Accuracy Rating</label>
                                        <div id="fb-stars" class="d-flex gap-1">
                                            <button class="btn btn-outline-warning btn-sm fb-star" data-val="1">1</button>
                                            <button class="btn btn-outline-warning btn-sm fb-star" data-val="2">2</button>
                                            <button class="btn btn-warning btn-sm fb-star active" data-val="3">3</button>
                                            <button class="btn btn-outline-warning btn-sm fb-star" data-val="4">4</button>
                                            <button class="btn btn-outline-warning btn-sm fb-star" data-val="5">5</button>
                                        </div>
                                        <small class="text-muted">1 = very inaccurate, 5 = very accurate</small>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Comments (optional)</label>
                                        <textarea id="fb-comment" class="form-control form-control-sm" rows="3" placeholder="What was inaccurate? What would improve the analysis?"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Your Name (optional)</label>
                                        <input type="text" id="fb-name" class="form-control form-control-sm" placeholder="Anonymous">
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="submitFeedback()">
                                        <i class="bi bi-send"></i> Submit Feedback
                                    </button>
                                    <!-- Feedback Receipt (visible confirmation) -->
                                    <div id="feedback-receipt" class="d-none mt-3">
                                        <div class="card border-success">
                                            <div class="card-header bg-success text-white py-1">
                                                <i class="bi bi-check-circle"></i> Feedback Recorded
                                            </div>
                                            <div class="card-body py-2" id="feedback-receipt-body"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="bi bi-graph-up"></i> Feedback Summary</div>
                                <div class="card-body" id="fb-summary-body">
                                    <p class="text-muted">No feedback collected yet. Submit feedback to track accuracy over time.</p>
                                </div>
                            </div>

                            <!-- Actionable Insights -->
                            <div id="fb-insights-section" class="d-none mt-3">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <i class="bi bi-lightbulb"></i> Actionable Insights
                                    </div>
                                    <div class="card-body" id="fb-insights-body"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Label Correction Section -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-6">
                            <div class="card border-warning">
                                <div class="card-header">
                                    <i class="bi bi-pencil-square"></i> Correct a Classification
                                    <small class="text-muted ms-2">(Closes the feedback loop)</small>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted small">
                                        When you see a misclassified fracture, submit the correct label here.
                                        After collecting corrections, click "Retrain" to update the model.
                                    </p>
                                    <div class="row g-2">
                                        <div class="col-md-4">
                                            <label class="form-label small">Fracture Index</label>
                                            <input type="number" id="corr-idx" class="form-control form-control-sm" value="0" min="0">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label small">Original Type</label>
                                            <select id="corr-original" class="form-select form-select-sm">
                                                <option value="">Model's prediction</option>
                                                <option value="Boundary">Boundary</option>
                                                <option value="Brecciated">Brecciated</option>
                                                <option value="Continuous">Continuous</option>
                                                <option value="Discontinuous">Discontinuous</option>
                                                <option value="Vuggy">Vuggy</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label small">Correct Type</label>
                                            <select id="corr-correct" class="form-select form-select-sm">
                                                <option value="Boundary">Boundary</option>
                                                <option value="Brecciated">Brecciated</option>
                                                <option value="Continuous">Continuous</option>
                                                <option value="Discontinuous">Discontinuous</option>
                                                <option value="Vuggy">Vuggy</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-2 d-flex gap-2">
                                        <button class="btn btn-warning btn-sm" onclick="submitCorrection()">
                                            <i class="bi bi-check-lg"></i> Submit Correction
                                        </button>
                                        <span class="small text-muted align-self-center" id="corr-count">0 corrections pending</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-arrow-repeat"></i> Retrain with Expert Corrections
                                </div>
                                <div class="card-body">
                                    <p class="text-muted small">
                                        After submitting label corrections, retrain the model to incorporate
                                        expert knowledge. This is how the AI improves from human feedback.
                                    </p>
                                    <button class="btn btn-success btn-sm" onclick="retrainModel()" id="btn-retrain" disabled>
                                        <i class="bi bi-arrow-repeat"></i> Retrain Model
                                    </button>
                                    <div id="retrain-result" class="mt-2 d-none"></div>
                                </div>
                            </div>
                            <div class="card mt-3">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span><i class="bi bi-question-circle"></i> How the Feedback Loop Works</span>
                                    <button class="btn btn-success btn-sm" onclick="runFeedbackEffectiveness()">
                                        <i class="bi bi-graph-up-arrow"></i> Track Effectiveness
                                    </button>
                                </div>
                                <div class="card-body">
                                    <ol class="mb-0 small">
                                        <li><strong>Rate analyses</strong> to track model accuracy over time</li>
                                        <li><strong>Correct labels</strong> when you spot misclassified fractures</li>
                                        <li><strong>Retrain</strong> to incorporate corrections into the model</li>
                                        <li><strong>Compare</strong> before/after accuracy to verify improvement</li>
                                        <li><strong>Repeat</strong> as more field data becomes available</li>
                                    </ol>
                                </div>
                            </div>
                            <!-- Feedback Effectiveness Results -->
                            <div id="effectiveness-results" class="d-none mt-3">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <i class="bi bi-graph-up-arrow"></i> Feedback Effectiveness Report
                                    </div>
                                    <div class="card-body" id="effectiveness-body"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RLHF Preference Model -->
                    <div class="card mt-4 border-success">
                        <div class="card-header bg-success bg-opacity-10">
                            <i class="bi bi-award"></i> RLHF Preference Model
                            <small class="text-muted ms-2">Learn from expert acceptance/rejection patterns</small>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Builds a reward model from your feedback history: which prediction types does the expert
                                trust vs distrust? Uses this to create reward-weighted training that focuses on expert preferences.
                            </p>
                            <button class="btn btn-success btn-sm mb-3" onclick="runPreferenceModel()">
                                <i class="bi bi-award-fill"></i> Build Preference Model
                            </button>
                            <div id="pref-results" class="d-none">
                                <div id="pref-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Reviews</div><div class="metric-value" id="pref-reviews">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Accepted</div><div class="metric-value" id="pref-accepted">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Rejected</div><div class="metric-value" id="pref-rejected">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">RLHF Effect</div><div class="metric-value" id="pref-improvement">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="pref-plot-img"></div>
                                <div id="pref-trust-section" class="d-none">
                                    <div class="card"><div class="card-header py-1"><i class="bi bi-shield-check"></i> Expert Trust per Type</div>
                                        <div class="card-body p-0"><table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Type</th><th>Accepted</th><th>Rejected</th><th>Trust</th></tr></thead>
                                            <tbody id="pref-trust-body"></tbody>
                                        </table></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Learning Section -->
                    <div class="card mt-4 border-info">
                        <div class="card-header bg-info text-white">
                            <i class="bi bi-bullseye"></i> Active Learning — Which Fractures to Review Next
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">
                                The AI identifies fractures it's most uncertain about. Reviewing these
                                gives the biggest improvement per expert-hour — this is human-in-the-loop learning.
                            </p>
                            <div class="d-flex gap-2 mb-3">
                                <button class="btn btn-info btn-sm" onclick="runActiveLearning()">
                                    <i class="bi bi-bullseye"></i> Find Uncertain Fractures
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="runQbcActiveLearning()">
                                    <i class="bi bi-people-fill"></i> Query-by-Committee (All Models)
                                </button>
                            </div>

                            <!-- QBC Results -->
                            <div id="qbc-results" class="d-none mb-4">
                                <div id="qbc-brief"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Committee Size</div><div class="metric-value" id="qbc-committee-size">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">High Disagreement</div><div class="metric-value" id="qbc-high-disagree">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Mean Vote Entropy</div><div class="metric-value" id="qbc-mean-ve">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Suggestions</div><div class="metric-value" id="qbc-n-suggestions">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="qbc-plot-img"></div>
                                <div class="card">
                                    <div class="card-header"><i class="bi bi-people-fill"></i> Committee Disagreement — Top Samples for Expert Review</div>
                                    <div class="card-body p-0" style="max-height:400px;overflow-y:auto">
                                        <table class="table table-hover table-sm mb-0">
                                            <thead class="table-light sticky-top">
                                                <tr><th>#</th><th>Depth</th><th>Well</th><th>Label</th><th>Committee Vote</th><th>Agreement</th><th>Score</th></tr>
                                            </thead>
                                            <tbody id="qbc-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div id="al-results" class="d-none">
                                <div class="mb-3" id="al-summary-text"></div>

                                <!-- Learning Curve -->
                                <div id="al-learning-curve" class="d-none mb-3">
                                    <h6><i class="bi bi-graph-up-arrow"></i> Learning Curve</h6>
                                    <div id="al-curve-body"></div>
                                </div>

                                <!-- Coverage Gaps -->
                                <div id="al-coverage" class="d-none mb-3">
                                    <h6><i class="bi bi-exclamation-diamond"></i> Data Coverage Gaps</h6>
                                    <div id="al-coverage-body"></div>
                                </div>

                                <!-- Suggested Samples -->
                                <div id="al-suggestions" class="d-none">
                                    <h6><i class="bi bi-list-check"></i> Fractures for Expert Review</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead><tr>
                                                <th>#</th><th>Well</th><th>Depth</th><th>Az</th><th>Dip</th>
                                                <th>Current Label</th><th>Predicted</th><th>Confidence</th><th>Mismatch</th>
                                            </tr></thead>
                                            <tbody id="al-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Calibrated Ensemble Prediction -->
                    <div class="card mb-4 border-primary mt-4">
                        <div class="card-header bg-primary bg-opacity-10">
                            <i class="bi bi-diagram-3"></i> Calibrated Ensemble Prediction
                            <small class="text-muted ms-2">Combine ALL models for maximum reliability</small>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Trains all available models (RF, GBM, XGB, LGB, CatBoost, LR, SVM) and combines
                                their predictions using accuracy-weighted voting. Shows inter-model agreement
                                and highlights samples where models disagree (high uncertainty).
                            </p>
                            <button class="btn btn-sm btn-outline-primary mb-3" onclick="runEnsemblePredict()">
                                <i class="bi bi-diagram-3-fill"></i> Run Ensemble
                            </button>
                            <div id="ens-results" class="d-none">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Ensemble Accuracy</div>
                                            <div class="metric-value text-primary" id="ens-acc">--</div>
                                            <small class="text-muted" id="ens-n-models">-- models</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Model Agreement</div>
                                            <div class="metric-value" id="ens-agreement">--</div>
                                            <small class="text-muted">inter-model consensus</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Uncertain Samples</div>
                                            <div class="metric-value text-warning" id="ens-uncertain">--</div>
                                            <small class="text-muted">models disagree</small>
                                        </div>
                                    </div>
                                </div>
                                <div id="ens-interpretation" class="alert alert-light small mb-3"></div>
                                <!-- Per-model breakdown -->
                                <div id="ens-models" class="mb-3"></div>
                                <!-- Uncertain samples table -->
                                <div id="ens-uncertain-table" class="d-none">
                                    <h6 class="text-warning"><i class="bi bi-exclamation-diamond"></i> Most Uncertain Samples</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-bordered">
                                            <thead><tr><th>Depth</th><th>Az</th><th>Dip</th><th>True Type</th><th>Agreement</th><th>Model Votes</th></tr></thead>
                                            <tbody id="ens-uncertain-tbody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Adversarial Robustness Test -->
                    <div class="card mb-4 border-warning mt-4">
                        <div class="card-header bg-warning bg-opacity-10">
                            <i class="bi bi-shield-shaded"></i> Adversarial Robustness Test
                            <small class="text-muted ms-2">Does the model survive noisy/adversarial data?</small>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Trains on augmented data (noise injection, boundary interpolation, edge cases)
                                and compares accuracy against the original model. A robust model should maintain
                                similar accuracy despite adversarial samples.
                            </p>
                            <div class="d-flex gap-2 mb-3 align-items-center">
                                <button class="btn btn-sm btn-outline-warning" onclick="runAugmentedClassify()">
                                    <i class="bi bi-shield-check"></i> Run Robustness Test
                                </button>
                                <small class="text-muted">Noise: <input type="number" id="aug-noise" value="5" min="1" max="20" style="width:50px" class="form-control form-control-sm d-inline-block"> deg</small>
                            </div>
                            <div id="aug-results" class="d-none">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Original Accuracy</div>
                                            <div class="metric-value" id="aug-orig-acc">--</div>
                                            <small class="text-muted" id="aug-orig-n">-- samples</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card">
                                            <div class="metric-label">Augmented Accuracy</div>
                                            <div class="metric-value" id="aug-new-acc">--</div>
                                            <small class="text-muted" id="aug-new-n">-- samples</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div id="aug-verdict" class="metric-card">
                                            <div class="metric-label">Robustness</div>
                                            <div class="metric-value" id="aug-robustness">--</div>
                                            <small class="text-muted" id="aug-change">--</small>
                                        </div>
                                    </div>
                                </div>
                                <div id="aug-interpretation" class="alert alert-light small"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Error Budget / Learning Curve -->
                    <div class="card mb-4 border-primary mt-4">
                        <div class="card-header bg-primary bg-opacity-10">
                            <i class="bi bi-graph-up"></i> Error Budget &amp; Learning Curve
                            <small class="text-muted ms-2">How much more data do you need?</small>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Shows how model accuracy changes with training set size. Diagnoses whether
                                you need more data, better features, or a different model — and estimates
                                the cost (in labeled samples) of each +1% accuracy improvement.
                            </p>
                            <button class="btn btn-sm btn-outline-primary mb-3" onclick="runErrorBudget()">
                                <i class="bi bi-calculator"></i> Compute Error Budget
                            </button>
                            <div id="eb-results" class="d-none">
                                <div id="eb-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Current Accuracy</div><div class="metric-value" id="eb-accuracy">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Train-Test Gap</div><div class="metric-value" id="eb-gap">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Diagnosis</div><div class="metric-value" id="eb-diagnosis">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Samples for +1%</div><div class="metric-value" id="eb-samples-needed">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="eb-plot-img"></div>
                                <div class="card">
                                    <div class="card-header py-1"><i class="bi bi-table"></i> Learning Curve Data</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Samples</th><th>Train Acc</th><th>Val Acc</th><th>Std</th></tr></thead>
                                            <tbody id="eb-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════ Sensitivity Tab ═══════ -->
                <div id="tab-sensitivity" class="tab-content">
                    <h5 class="mb-3">Parameter Sensitivity Analysis</h5>
                    <p class="text-muted">How do results change when assumptions vary? Essential for understanding how robust your conclusions are.</p>

                    <!-- Interactive What-If Explorer -->
                    <div class="card border-primary mb-4">
                        <div class="card-header bg-primary text-white"><i class="bi bi-sliders2"></i> Interactive What-If Explorer</div>
                        <div class="card-body">
                            <p class="small text-muted">Adjust parameters below and click "Run What-If" to see how results change in real time.</p>
                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold">Friction Coefficient (μ)</label>
                                    <input type="range" class="form-range" id="whatif-friction" min="0.2" max="1.0" step="0.05" value="0.6">
                                    <div class="d-flex justify-content-between small text-muted">
                                        <span>0.2 (weak)</span>
                                        <span id="whatif-friction-val" class="fw-bold text-primary">0.6</span>
                                        <span>1.0 (strong)</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold">Pore Pressure (MPa)</label>
                                    <input type="range" class="form-range" id="whatif-pp" min="0" max="50" step="1" value="0">
                                    <div class="d-flex justify-content-between small text-muted">
                                        <span>0 (dry)</span>
                                        <span id="whatif-pp-val" class="fw-bold text-primary">0</span>
                                        <span>50 (overpressured)</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold">Depth (m)</label>
                                    <input type="range" class="form-range" id="whatif-depth" min="1000" max="6000" step="100" value="3000">
                                    <div class="d-flex justify-content-between small text-muted">
                                        <span>1000m</span>
                                        <span id="whatif-depth-val" class="fw-bold text-primary">3000</span>
                                        <span>6000m</span>
                                    </div>
                                </div>
                            </div>
                            <div class="small text-muted mb-2"><i class="bi bi-info-circle"></i> Sliders auto-run when you stop dragging. Results update in real time.</div>
                            <button class="btn btn-primary btn-sm" onclick="runWhatIf()">
                                <i class="bi bi-play-fill"></i> Run What-If
                            </button>
                            <div id="whatif-results" class="mt-3 d-none"></div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runSensitivity()">
                            <i class="bi bi-sliders"></i> Run Full Sensitivity Analysis
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="runSensitivityHeatmap()">
                            <i class="bi bi-grid-3x3"></i> Sensitivity Heatmap
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="runWorstCase()">
                            <i class="bi bi-exclamation-octagon"></i> Worst-Case Scenarios
                        </button>
                    </div>
                    <div id="worst-case-results" class="d-none mb-4">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <i class="bi bi-exclamation-octagon"></i> Worst-Case Scenario Analysis
                            </div>
                            <div class="card-body" id="worst-case-body"></div>
                        </div>
                    </div>
                    <div id="heatmap-results" class="d-none mb-4">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <i class="bi bi-grid-3x3"></i> Sensitivity Heatmap — Friction × Pore Pressure
                            </div>
                            <div class="card-body" id="heatmap-body"></div>
                        </div>
                    </div>

                    <!-- Tornado Diagram -->
                    <div id="sens-tornado" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-tornado"></i> Tornado Diagram — Impact on Critically Stressed %</div>
                            <div class="card-body" id="sens-tornado-body"></div>
                        </div>
                    </div>

                    <!-- Risk Implications -->
                    <div id="sens-risks" class="d-none mb-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark"><i class="bi bi-exclamation-triangle"></i> Risk Implications</div>
                            <div class="card-body" id="sens-risks-body"></div>
                        </div>
                    </div>

                    <!-- Regime Comparison Table -->
                    <div id="sens-regime" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-arrows-angle-expand"></i> Regime Comparison</div>
                            <div class="card-body" id="sens-regime-body"></div>
                        </div>
                    </div>

                    <!-- Friction & Pore Pressure Detail -->
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div id="sens-friction" class="d-none">
                                <div class="card">
                                    <div class="card-header"><i class="bi bi-speedometer2"></i> Friction Coefficient Sensitivity</div>
                                    <div class="card-body" id="sens-friction-body"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div id="sens-pp" class="d-none">
                                <div class="card">
                                    <div class="card-header"><i class="bi bi-droplet"></i> Pore Pressure Sensitivity</div>
                                    <div class="card-body" id="sens-pp-body"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════ Risk Matrix Tab ═══════ -->
                <div id="tab-risk" class="tab-content">
                    <h5 class="mb-3">Operational Risk Assessment</h5>
                    <p class="text-muted">GO / NO-GO decision framework combining all analysis results.</p>

                    <button class="btn btn-primary btn-sm mb-3" onclick="runRiskMatrix()">
                        <i class="bi bi-shield-check"></i> Compute Risk Matrix
                    </button>

                    <!-- Overall Risk Banner -->
                    <div id="risk-overall" class="d-none mb-4">
                        <div class="card" id="risk-overall-card">
                            <div class="card-body text-center py-4">
                                <h2 id="risk-go-nogo" class="mb-2"></h2>
                                <div id="risk-score-badge" class="fs-4 fw-bold mb-2"></div>
                                <p id="risk-detail" class="text-muted mb-0"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Factors Table -->
                    <div id="risk-factors" class="d-none">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-list-check"></i> Risk Factor Breakdown</div>
                            <div class="card-body">
                                <table class="table table-hover table-sm">
                                    <thead>
                                        <tr>
                                            <th>Risk Factor</th>
                                            <th>Score</th>
                                            <th>Detail</th>
                                            <th>Mitigation</th>
                                        </tr>
                                    </thead>
                                    <tbody id="risk-factors-tbody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════ Near-Miss Safety Tab ═══════ -->
                <div id="tab-near-miss" class="tab-content">
                    <div class="alert alert-warning border py-2 mb-3 small"><i class="bi bi-exclamation-triangle-fill text-warning"></i> <strong>Industrial Safety Analysis</strong> &mdash; Identifies predictions that were correct but nearly wrong (near-misses), model blind spots, and computes risk scores per API RP 580/581 standards. Near-misses are leading indicators of future failures.</div>
                    <div class="d-flex gap-2 mb-3">
                        <select id="nm-classifier-select" class="form-select form-select-sm" style="width:auto">
                            <option value="random_forest" selected>Random Forest</option>
                            <option value="gradient_boosting">Gradient Boosting</option>
                            <option value="xgboost">XGBoost</option>
                            <option value="lightgbm">LightGBM</option>
                        </select>
                        <button class="btn btn-warning btn-sm" onclick="runNearMissAnalysis()">
                            <i class="bi bi-shield-exclamation"></i> Analyze Near-Misses & Blind Spots
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="runFailureDashboard()">
                            <i class="bi bi-speedometer"></i> Full Safety Dashboard (API RP 580)
                        </button>
                    </div>

                    <div id="nm-results" class="d-none">
                        <div id="nm-brief"></div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Near-Misses</div><div class="metric-value" id="nm-count">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Blind Spots</div><div class="metric-value" id="nm-blind-spots">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">RED Risk Items</div><div class="metric-value" id="nm-red-risk">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Overall Accuracy</div><div class="metric-value" id="nm-accuracy">--</div></div></div>
                        </div>

                        <!-- Risk matrix plot -->
                        <div class="row g-3 mb-3">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-dark text-white"><i class="bi bi-graph-up-arrow"></i> API RP 580 Risk Matrix & Margin Distribution</div>
                                    <div class="card-body text-center" id="nm-plot-img"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Near-miss table -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-exclamation-diamond"></i> Near-Miss Predictions (sorted by risk)</div>
                            <div class="card-body p-0" style="max-height:400px;overflow-y:auto">
                                <table class="table table-hover table-sm mb-0">
                                    <thead class="table-light sticky-top">
                                        <tr><th>#</th><th>Depth</th><th>Well</th><th>True</th><th>Predicted</th><th>Confidence</th><th>Margin</th><th>Runner-Up</th><th>Risk</th></tr>
                                    </thead>
                                    <tbody id="nm-table-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Blind spots table -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-eye-slash"></i> Model Blind Spots (high-error feature ranges)</div>
                            <div class="card-body p-0" style="max-height:300px;overflow-y:auto">
                                <table class="table table-hover table-sm mb-0">
                                    <thead class="table-light sticky-top">
                                        <tr><th>Feature</th><th>Range</th><th>Error Rate</th><th>Baseline</th><th>Samples</th><th>Severity</th></tr>
                                    </thead>
                                    <tbody id="nm-bs-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Stakeholder Decision Report + Negative Outcomes + Model Arena + Auto-Retrain -->
                    <div class="card border-primary mt-4 mb-4">
                        <div class="card-header bg-primary text-white"><i class="bi bi-file-earmark-text"></i> Advanced Industrial Analysis</div>
                        <div class="card-body">
                            <div class="d-flex gap-2 flex-wrap mb-3">
                                <button class="btn btn-primary btn-sm" onclick="runStakeholderReport()">
                                    <i class="bi bi-file-earmark-bar-graph"></i> Stakeholder Decision Report
                                </button>
                                <button class="btn btn-success btn-sm" onclick="runModelArena()">
                                    <i class="bi bi-trophy"></i> Model Arena (Compare All)
                                </button>
                                <button class="btn btn-info btn-sm" onclick="runAutoRetrain()">
                                    <i class="bi bi-arrow-repeat"></i> Auto-Retrain from Feedback
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="runNegativeOutcomes()">
                                    <i class="bi bi-bug"></i> Negative Outcome Learning
                                </button>
                            </div>

                            <!-- Stakeholder Decision Report Results -->
                            <div id="sdr-results" class="d-none mb-4">
                                <h5><i class="bi bi-file-earmark-bar-graph"></i> Stakeholder Decision Report</h5>
                                <div id="sdr-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-2"><div class="metric-card"><div class="metric-label">Decision</div><div class="metric-value fs-5" id="sdr-decision">--</div></div></div>
                                    <div class="col-md-2"><div class="metric-card"><div class="metric-label">Score</div><div class="metric-value" id="sdr-score">--</div></div></div>
                                    <div class="col-md-2"><div class="metric-card"><div class="metric-label">Accuracy</div><div class="metric-value" id="sdr-accuracy">--</div></div></div>
                                    <div class="col-md-2"><div class="metric-card"><div class="metric-label">Econ Risk</div><div class="metric-value" id="sdr-econ-risk">--</div></div></div>
                                    <div class="col-md-2"><div class="metric-card"><div class="metric-label">Low Conf</div><div class="metric-value" id="sdr-low-conf">--</div></div></div>
                                    <div class="col-md-2"><div class="metric-card"><div class="metric-label">Reviews</div><div class="metric-value" id="sdr-reviews">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="sdr-plot-img"></div>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card"><div class="card-header py-1"><i class="bi bi-shield"></i> Per-Class Risk</div>
                                            <div class="card-body p-0" style="max-height:250px;overflow-y:auto">
                                                <table class="table table-sm table-hover mb-0">
                                                    <thead class="table-light"><tr><th>Class</th><th>Recall</th><th>Risk Score</th><th>Verdict</th></tr></thead>
                                                    <tbody id="sdr-class-risk-body"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card"><div class="card-header py-1"><i class="bi bi-list-check"></i> Evidence Chain</div>
                                            <div class="card-body p-0" style="max-height:250px;overflow-y:auto">
                                                <table class="table table-sm mb-0">
                                                    <thead class="table-light"><tr><th>Factor</th><th>Impact</th><th>Severity</th></tr></thead>
                                                    <tbody id="sdr-evidence-body"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Model Arena Results -->
                            <div id="arena-results" class="d-none mb-4">
                                <h5><i class="bi bi-trophy"></i> Model Arena</h5>
                                <div id="arena-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Model</div><div class="metric-value" id="arena-best">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Best Accuracy</div><div class="metric-value" id="arena-best-acc">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Models Tested</div><div class="metric-value" id="arena-n-models">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Composite</div><div class="metric-value" id="arena-composite">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="arena-plot-img"></div>
                                <div class="card"><div class="card-header py-1"><i class="bi bi-table"></i> Full Ranking</div>
                                    <div class="card-body p-0"><table class="table table-sm table-hover mb-0">
                                        <thead class="table-light"><tr><th>Rank</th><th>Model</th><th>Accuracy</th><th>F1</th><th>Bal Acc</th><th>ECE</th><th>Speed</th><th>Composite</th></tr></thead>
                                        <tbody id="arena-table-body"></tbody>
                                    </table></div>
                                </div>
                            </div>

                            <!-- Auto-Retrain Results -->
                            <div id="retrain-results" class="d-none mb-4">
                                <h5><i class="bi bi-arrow-repeat"></i> Auto-Retrain from Feedback</h5>
                                <div id="retrain-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Status</div><div class="metric-value" id="retrain-status">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="retrain-improvement">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Corrections Used</div><div class="metric-value" id="retrain-corrections">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Failures Used</div><div class="metric-value" id="retrain-failures">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="retrain-plot-img"></div>
                            </div>

                            <!-- Negative Outcome Results -->
                            <div id="negout-results" class="d-none mb-4">
                                <h5><i class="bi bi-bug"></i> Negative Outcome Learning</h5>
                                <div id="negout-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Errors Found</div><div class="metric-value" id="negout-errors">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Biases</div><div class="metric-value" id="negout-biases">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Synthetic Added</div><div class="metric-value" id="negout-synthetic">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Improvement</div><div class="metric-value" id="negout-improvement">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="negout-plot-img"></div>
                                <div id="negout-biases-section" class="d-none">
                                    <div class="card"><div class="card-header py-1"><i class="bi bi-exclamation-triangle"></i> Systematic Biases</div>
                                        <div class="card-body p-0"><table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>True Class</th><th>Error Rate</th><th>Confused With</th><th>Count</th></tr></thead>
                                            <tbody id="negout-bias-body"></tbody>
                                        </table></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Industrial Readiness Scorecard -->
                    <div class="card border-dark mt-4 mb-4">
                        <div class="card-header bg-dark text-white"><i class="bi bi-clipboard2-check"></i> Industrial Readiness Scorecard</div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Comprehensive 7-dimension assessment: model accuracy, class balance, data volume, depth coverage,
                                expert review coverage, cross-well transfer, and failure management. Grades A-F with weighted overall score.
                            </p>
                            <button class="btn btn-dark btn-sm" onclick="runReadinessScorecard()">
                                <i class="bi bi-clipboard2-check"></i> Generate Readiness Report
                            </button>
                            <div id="rs-results" class="d-none mt-3">
                                <div id="rs-brief" class="mb-2"></div>
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Readiness</div><div class="metric-value fs-5" id="rs-readiness">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Overall Score</div><div class="metric-value" id="rs-score">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Samples</div><div class="metric-value" id="rs-samples">--</div></div></div>
                                    <div class="col-md-3"><div class="metric-card"><div class="metric-label">Wells</div><div class="metric-value" id="rs-wells">--</div></div></div>
                                </div>
                                <div class="text-center mb-3" id="rs-plot-img"></div>
                                <div class="card mb-3">
                                    <div class="card-header py-1"><i class="bi bi-list-columns-reverse"></i> Dimension Grades</div>
                                    <div class="card-body p-0">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="table-light"><tr><th>Dimension</th><th>Grade</th><th>Score</th><th>Detail</th><th>Action Required</th><th>Weight</th></tr></thead>
                                            <tbody id="rs-dimensions-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="rs-priority-section" class="d-none">
                                    <div class="card border-danger">
                                        <div class="card-header bg-danger bg-opacity-10 py-1"><i class="bi bi-exclamation-octagon text-danger"></i> <strong>Priority Actions</strong></div>
                                        <div class="card-body py-2">
                                            <ul id="rs-priority-list" class="mb-0 small"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Decision Confidence Dashboard -->
                    <div class="card border-danger mt-4 mb-4">
                        <div class="card-header bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-stoplights"></i> <strong>GO / NO-GO Decision Dashboard</strong></span>
                            <button class="btn btn-sm btn-outline-danger" onclick="runDecisionDashboard()">
                                <i class="bi bi-play-fill"></i> Evaluate
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Traffic-light system evaluating 6 quality signals: model accuracy, balanced accuracy, data volume,
                                class balance, expert review coverage, and per-class reliability. Includes best/expected/worst scenario analysis.
                            </p>
                            <div id="dd-results" class="d-none">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-3">
                                        <div class="metric-card"><div class="metric-label">Overall Decision</div>
                                        <div class="metric-value fs-3" id="dd-decision">--</div></div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card"><div class="metric-label">Accuracy</div>
                                        <div class="metric-value" id="dd-accuracy">--</div></div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card"><div class="metric-label">Balanced Acc</div>
                                        <div class="metric-value" id="dd-bal-acc">--</div></div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card"><div class="metric-label">Samples</div>
                                        <div class="metric-value" id="dd-samples">--</div></div>
                                    </div>
                                </div>
                                <h6><i class="bi bi-stoplights"></i> Quality Signals</h6>
                                <div class="row g-2 mb-3" id="dd-signals-row"></div>
                                <h6><i class="bi bi-list-check"></i> Per-Class Decisions</h6>
                                <div class="table-responsive mb-3">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light"><tr><th>Class</th><th>Recall</th><th>Precision</th><th>Support</th><th>Decision</th><th>Reason</th></tr></thead>
                                        <tbody id="dd-class-body"></tbody>
                                    </table>
                                </div>
                                <h6><i class="bi bi-graph-up-arrow"></i> Scenario Analysis</h6>
                                <div class="row g-2 mb-3" id="dd-scenarios-row"></div>
                                <div id="dd-actions" class="d-none">
                                    <h6><i class="bi bi-arrow-right-circle"></i> Recommended Actions</h6>
                                    <ul id="dd-action-list" class="small"></ul>
                                </div>
                                <div class="text-center"><img id="dd-plot" class="img-fluid" style="max-width:800px" /></div>
                            </div>
                        </div>
                    </div>

                    <!-- Full Safety Dashboard -->
                    <div id="safety-dashboard" class="d-none mt-4">
                        <h4 class="mb-3"><i class="bi bi-shield-fill-check"></i> Industrial Safety Dashboard</h4>
                        <div id="safety-brief"></div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4"><div class="metric-card"><div class="metric-label">Safety Score</div><div class="metric-value fs-2" id="safety-score">--</div></div></div>
                            <div class="col-md-4"><div class="metric-card"><div class="metric-label">Decision</div><div class="metric-value" id="safety-decision">--</div></div></div>
                            <div class="col-md-4"><div class="metric-card"><div class="metric-label">Risk Factors</div><div class="metric-value" id="safety-factors">--</div></div></div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header bg-dark text-white"><i class="bi bi-speedometer"></i> Safety Gauge & Risk Factor Breakdown</div>
                            <div class="card-body text-center" id="safety-plot-img"></div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-list-check"></i> Risk Factor Detail (API RP 580/581)</div>
                            <div class="card-body p-0">
                                <table class="table table-hover table-sm mb-0">
                                    <thead class="table-light"><tr><th>Factor</th><th>Value</th><th>Threshold</th><th>Score</th><th>Status</th></tr></thead>
                                    <tbody id="safety-factors-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════ Uncertainty Budget Tab ═══════ -->
                <div id="tab-uncertainty" class="tab-content">
                    <h5 class="mb-3">Uncertainty Budget</h5>
                    <p class="text-muted">Where does the most uncertainty come from? This tells you what data to acquire next to get the biggest improvement in prediction confidence.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runUncertaintyBudget(false)">
                            <i class="bi bi-clipboard-pulse"></i> Compute Budget
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="runUncertaintyBudget(true)">
                            <i class="bi bi-distribute-vertical"></i> Include Bayesian (slower)
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="runCalibrationReport()">
                            <i class="bi bi-speedometer2"></i> Calibration Report + OOD
                        </button>
                    </div>

                    <!-- Calibration Report -->
                    <div id="cal-report" class="d-none mb-4">
                        <div id="cal-brief"></div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">ECE (Calibrated)</div><div class="metric-value" id="cal-ece">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">ECE Improvement</div><div class="metric-value" id="cal-improvement">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Brier Score</div><div class="metric-value" id="cal-brier">--</div></div></div>
                            <div class="col-md-3"><div class="metric-card"><div class="metric-label">Quality</div><div class="metric-value" id="cal-quality">--</div></div></div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header bg-dark text-white"><i class="bi bi-speedometer2"></i> Reliability Diagram & Confidence Distribution</div>
                            <div class="card-body text-center" id="cal-plot-img"></div>
                        </div>
                        <div class="card mb-3" id="cal-ood-section">
                            <div class="card-header"><i class="bi bi-globe2"></i> Out-of-Distribution Detection per Well (Mahalanobis Distance)</div>
                            <div class="card-body p-0">
                                <table class="table table-hover table-sm mb-0">
                                    <thead class="table-light"><tr><th>Well</th><th>Mean Mahal.</th><th>Max Mahal.</th><th>% OOD</th><th>Samples</th><th>Severity</th></tr></thead>
                                    <tbody id="cal-ood-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Uncertainty Banner -->
                    <div id="ub-overall" class="d-none mb-4">
                        <div class="card" id="ub-overall-card">
                            <div class="card-body text-center py-4">
                                <h2 id="ub-level" class="mb-2"></h2>
                                <div class="fs-4 fw-bold mb-2" id="ub-total-score"></div>
                                <p id="ub-dominant" class="text-muted mb-0"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Stakeholder Summary -->
                    <div id="ub-summary" class="d-none mb-4">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-megaphone"></i> What This Means
                            </div>
                            <div class="card-body" id="ub-summary-body"></div>
                        </div>
                    </div>

                    <!-- Source Rankings -->
                    <div id="ub-sources" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-sort-down"></i> Uncertainty Sources (Ranked by Impact)</div>
                            <div class="card-body" id="ub-sources-body"></div>
                        </div>
                    </div>

                    <!-- Recommended Actions -->
                    <div id="ub-actions" class="d-none">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <i class="bi bi-signpost-split"></i> Recommended Actions (Priority Order)
                            </div>
                            <div class="card-body" id="ub-actions-body"></div>
                        </div>
                    </div>

                    <!-- Stakeholder Uncertainty Dashboard -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-speedometer"></i> Quick Confidence Dashboard</h5>
                    <p class="text-muted small">One-glance confidence check across 5 key signals. Designed for non-technical stakeholders.</p>

                    <button class="btn btn-warning btn-sm mb-3" onclick="runUncertaintyDashboard()">
                        <i class="bi bi-lightning"></i> Run Quick Confidence Check
                    </button>

                    <div id="ud-results" class="d-none">
                        <!-- Overall Confidence Grade -->
                        <div class="card mb-3" id="ud-overall-card">
                            <div class="card-body text-center py-4">
                                <div class="small text-muted mb-1">OVERALL CONFIDENCE</div>
                                <h1 id="ud-grade" class="display-4 fw-bold mb-1">--</h1>
                                <div class="fs-5" id="ud-score">--</div>
                                <p class="mt-2 mb-0" id="ud-advice"></p>
                            </div>
                        </div>

                        <!-- Signal Cards -->
                        <div class="row g-3 mb-3" id="ud-signals"></div>
                    </div>

                    <!-- Prediction Trustworthiness Report -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-clipboard-check"></i> Prediction Trustworthiness Report</h5>
                    <p class="text-muted small">Comprehensive reliability assessment across 5 dimensions: data quality, cross-validation stability, calibration, validity prefilter, and class balance. Answers: "Can I trust these predictions?"</p>

                    <button class="btn btn-primary btn-sm mb-3" onclick="runTrustworthinessReport()">
                        <i class="bi bi-search"></i> Run Full Trustworthiness Audit
                    </button>

                    <div id="tr-results" class="d-none">
                        <!-- Overall trust level -->
                        <div id="tr-overall" class="card mb-3">
                            <div class="card-body text-center py-4">
                                <div class="small text-muted mb-1">PREDICTION TRUSTWORTHINESS</div>
                                <h2 id="tr-trust-level" class="fw-bold mb-1">--</h2>
                                <div class="fs-5" id="tr-score">--</div>
                                <p class="mt-2 mb-0" id="tr-advice"></p>
                            </div>
                        </div>

                        <!-- Check cards -->
                        <div class="row g-3 mb-3" id="tr-checks"></div>

                        <!-- All issues list -->
                        <div id="tr-issues-section" class="d-none">
                            <h6 class="mt-3"><i class="bi bi-exclamation-triangle"></i> Issues Found</h6>
                            <div id="tr-issues"></div>
                        </div>
                    </div>

                    <!-- Negative Scenario Check -->
                    <div class="card mb-4 border-danger mt-4">
                        <div class="card-header bg-danger bg-opacity-10">
                            <i class="bi bi-shield-exclamation"></i> Negative Scenario Check
                            <small class="text-muted ms-2">Known failure modes in geostress analysis</small>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-2">
                                Checks your data against 8 known failure scenarios from industry experience.
                                Each triggered scenario includes evidence, consequences, and recommended actions.
                            </p>
                            <button class="btn btn-outline-danger btn-sm mb-3" onclick="runScenarioCheck()">
                                <i class="bi bi-shield-check"></i> Run Scenario Check
                            </button>
                            <button class="btn btn-outline-secondary btn-sm mb-3 ms-2" onclick="viewScenarioLibrary()">
                                <i class="bi bi-book"></i> View Full Library
                            </button>
                            <div id="sc-results" class="d-none">
                                <div id="sc-overall" class="alert mb-3 text-center">
                                    <h5 id="sc-status" class="fw-bold mb-1">--</h5>
                                    <span id="sc-summary" class="small"></span>
                                </div>
                                <div id="sc-triggered"></div>
                                <div id="sc-safe" class="d-none mt-3">
                                    <h6 class="text-success"><i class="bi bi-check-circle"></i> Passed Checks</h6>
                                    <div id="sc-safe-list"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════ Well Comparison Tab ═══════ -->
                <div id="tab-wells" class="tab-content">
                    <h5 class="mb-3">Multi-Well Comparison</h5>
                    <p class="text-muted">Compare stress fields, model performance, and data quality across wells.</p>

                    <button class="btn btn-primary btn-sm mb-3" onclick="runWellComparison()">
                        <i class="bi bi-building"></i> Compare Wells
                    </button>

                    <!-- Consistency Checks -->
                    <div id="wells-consistency" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-check2-all"></i> Consistency Checks</div>
                            <div class="card-body" id="wells-consistency-body"></div>
                        </div>
                    </div>

                    <!-- Well Results Table -->
                    <div id="wells-table" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-table"></i> Per-Well Results</div>
                            <div class="card-body" id="wells-table-body"></div>
                        </div>
                    </div>

                    <!-- Cross-Validation -->
                    <div id="wells-crossval" class="d-none">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-arrow-left-right"></i> Cross-Well Classification Accuracy</div>
                            <div class="card-body" id="wells-crossval-body"></div>
                        </div>
                    </div>
                </div>

                <!-- ═══════ Well Report Tab ═══════ -->
                <div id="tab-report" class="tab-content">
                    <h5 class="mb-3">Stakeholder Well Report</h5>
                    <p class="text-muted">Generate a comprehensive report for printing or stakeholder presentation.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="generateReport()">
                            <i class="bi bi-file-earmark-text"></i> Generate Report
                        </button>
                        <button class="btn btn-outline-secondary btn-sm d-none" id="btn-print-report" onclick="window.print()">
                            <i class="bi bi-printer"></i> Print Report
                        </button>
                    </div>

                    <div id="report-content" class="d-none">
                        <!-- Executive Summary -->
                        <div class="card mb-3 border-primary">
                            <div class="card-header bg-primary text-white"><i class="bi bi-file-text"></i> Executive Summary</div>
                            <div class="card-body fs-6" id="report-exec-summary"></div>
                        </div>

                        <!-- Stress State -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-arrows-angle-expand"></i> Stress State</div>
                            <div class="card-body" id="report-stress"></div>
                        </div>

                        <!-- Risk Assessment -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-shield-exclamation"></i> Risk Assessment</div>
                            <div class="card-body" id="report-risk"></div>
                        </div>

                        <!-- Recommendations -->
                        <div class="card mb-3 border-success">
                            <div class="card-header bg-success text-white"><i class="bi bi-signpost-split"></i> Operational Recommendations</div>
                            <div class="card-body" id="report-recommendations"></div>
                        </div>

                        <!-- Data Quality -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-clipboard-data"></i> Data Quality</div>
                            <div class="card-body" id="report-quality"></div>
                        </div>
                    </div>
                </div>

                <!-- Calibration Tab -->
                <div id="tab-calibration" class="tab-content">
                    <h5 class="mb-3">Model Calibration Assessment</h5>
                    <p class="text-muted">Are the model's confidence values reliable? Calibration measures whether "80% confident" truly means 80% accurate.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runCalibration()">
                            <i class="bi bi-bullseye"></i> Run Calibration Check
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="runOODCheck()">
                            <i class="bi bi-exclamation-triangle"></i> Distribution Check
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="runDataRecommendations()">
                            <i class="bi bi-lightbulb"></i> Data Recommendations
                        </button>
                    </div>

                    <!-- Calibration Results -->
                    <div id="calibration-results" class="d-none">
                        <div class="row mb-3" id="calibration-metrics"></div>
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-bar-chart"></i> Confidence vs. Accuracy</div>
                            <div class="card-body" id="calibration-bins"></div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-diagram-3"></i> Per-Class Calibration</div>
                            <div class="card-body" id="calibration-per-class"></div>
                        </div>
                    </div>

                    <!-- OOD Results -->
                    <div id="ood-results" class="d-none">
                        <div class="card mb-3" id="ood-card"></div>
                    </div>

                    <!-- Data Recommendations -->
                    <div id="data-rec-results" class="d-none">
                        <div id="data-rec-content"></div>
                    </div>

                    <hr class="my-4">

                    <!-- Field Calibration Section -->
                    <h5 class="mb-3"><i class="bi bi-geo-alt"></i> Field Stress Calibration</h5>
                    <p class="text-muted small">Compare model predictions against actual field measurements (LOT, XLOT, minifrac). This is the gold standard for validating geomechanical models in the oil industry.</p>

                    <div class="card mb-3">
                        <div class="card-header"><i class="bi bi-plus-circle"></i> Add Field Measurement</div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label class="form-label small">Test Type</label>
                                    <select class="form-select form-select-sm" id="field-test-type">
                                        <option value="LOT">LOT (Leak-Off Test)</option>
                                        <option value="XLOT">XLOT (Extended LOT)</option>
                                        <option value="minifrac">Minifrac</option>
                                        <option value="hydraulic_fracture">Hydraulic Fracture</option>
                                        <option value="breakout">Borehole Breakout</option>
                                        <option value="DIF">Drilling-Induced Fracture</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Depth (m)</label>
                                    <input type="number" class="form-control form-control-sm" id="field-depth" value="3000" min="0" max="15000">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Stress (MPa)</label>
                                    <input type="number" class="form-control form-control-sm" id="field-stress" value="50" min="0" max="200" step="0.1">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small">Direction</label>
                                    <select class="form-select form-select-sm" id="field-direction">
                                        <option value="Shmin">Shmin (from LOT)</option>
                                        <option value="SHmax">SHmax</option>
                                        <option value="Sv">Sv (overburden)</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small">Azimuth (optional)</label>
                                    <input type="number" class="form-control form-control-sm" id="field-azimuth" placeholder="0-360" min="0" max="360">
                                </div>
                            </div>
                            <div class="row g-2 mt-2">
                                <div class="col-md-9">
                                    <input type="text" class="form-control form-control-sm" id="field-notes" placeholder="Notes (e.g., formation name, test quality...)">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-success btn-sm w-100" onclick="addFieldMeasurement()">
                                        <i class="bi bi-plus-lg"></i> Add Measurement
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runFieldValidation()">
                            <i class="bi bi-check2-circle"></i> Validate Against Field Data
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="loadFieldMeasurements()">
                            <i class="bi bi-list-ul"></i> View All Measurements
                        </button>
                    </div>

                    <div id="field-validation-results" class="d-none">
                        <div class="row mb-3" id="field-cal-metrics"></div>
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-table"></i> Measurement vs Prediction</div>
                            <div class="card-body" id="field-cal-table"></div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-info-circle"></i> Recommendations</div>
                            <div class="card-body" id="field-cal-recommendations"></div>
                        </div>
                    </div>
                </div>

                <!-- Decision Support Tab -->
                <div id="tab-decision" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-signpost-split"></i> Decision Support Matrix</h5>
                    <p class="text-muted small">Compares all stress regime options side-by-side with go/no-go recommendations, trade-offs, and confidence levels. Designed for non-technical stakeholders making drilling decisions.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runDecisionMatrix()">
                            <i class="bi bi-play-fill"></i> Generate Decision Matrix
                        </button>
                    </div>

                    <div id="dm-results" class="d-none">
                        <!-- Recommended Action -->
                        <div id="dm-action" class="alert alert-primary mb-3">
                            <i class="bi bi-lightbulb-fill me-1"></i>
                            <strong>Recommended Action:</strong>
                            <span id="dm-action-text"></span>
                        </div>

                        <!-- Confidence Assessment -->
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Overall Confidence</div>
                                    <div class="metric-value" id="dm-confidence">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Data Quality</div>
                                    <div class="metric-value" id="dm-quality">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Regime Certainty</div>
                                    <div class="metric-value" id="dm-regime-cert">--</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-label">Fractures</div>
                                    <div class="metric-value" id="dm-n-frac">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Regime Options Table -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-table"></i> Regime Comparison</div>
                            <div class="card-body p-0">
                                <table class="table table-sm table-striped mb-0" id="dm-options-table">
                                    <thead><tr>
                                        <th>Regime</th><th>&sigma;1</th><th>&sigma;3</th><th>SHmax</th><th>Misfit</th><th>Crit. Stressed</th><th>Risk</th><th>Go/No-Go</th>
                                    </tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Risk Comparison -->
                        <div id="dm-risk-comparison" class="d-none row g-3 mb-3">
                            <div class="col-md-4">
                                <div class="card h-100 border-success">
                                    <div class="card-body text-center">
                                        <div class="small text-muted">Safest Option</div>
                                        <div class="fw-bold" id="dm-safest">--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 border-primary">
                                    <div class="card-body text-center">
                                        <div class="small text-muted">Best Data Fit</div>
                                        <div class="fw-bold" id="dm-best-fit">--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 border-warning">
                                    <div class="card-body text-center">
                                        <div class="small text-muted">Most Conservative</div>
                                        <div class="fw-bold" id="dm-conservative">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Trade-offs -->
                        <div id="dm-tradeoffs" class="d-none">
                            <h6><i class="bi bi-exclamation-triangle"></i> Key Trade-offs</h6>
                            <div id="dm-tradeoff-list"></div>
                        </div>
                    </div>

                    <!-- Expert Stress Ranking (RLHF) -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-award"></i> Expert Stress Solution Ranking</h5>
                    <p class="text-muted small">Compare all 3 regime solutions with Mohr circles. Select the one you trust most — your feedback improves future auto-detection.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-primary btn-sm" onclick="runExpertRanking()">
                            <i class="bi bi-play-fill"></i> Generate Solutions for Review
                        </button>
                    </div>

                    <div id="esr-results" class="d-none">
                        <div id="esr-auto-summary" class="alert alert-info mb-3">
                            <i class="bi bi-robot me-1"></i>
                            <strong>Auto-Detection:</strong> <span id="esr-auto-text"></span>
                        </div>

                        <div class="row g-3 mb-3" id="esr-solutions"></div>

                        <!-- Expert Selection Form -->
                        <div class="card border-primary mb-3">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-hand-thumbs-up"></i> Your Expert Assessment
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Preferred Regime</label>
                                        <select id="esr-select-regime" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="normal">Normal</option>
                                            <option value="strike_slip">Strike-Slip</option>
                                            <option value="thrust">Thrust</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Your Confidence</label>
                                        <select id="esr-select-confidence" class="form-select">
                                            <option value="LOW">Low — guessing</option>
                                            <option value="MODERATE" selected>Moderate — plausible</option>
                                            <option value="HIGH">High — field evidence supports this</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Reason (optional)</label>
                                        <input type="text" id="esr-reason" class="form-control" placeholder="e.g., Regional geology suggests normal faulting">
                                    </div>
                                </div>
                                <button class="btn btn-primary btn-sm mt-3" onclick="submitExpertSelection()">
                                    <i class="bi bi-check2-circle"></i> Submit Expert Selection
                                </button>
                                <div id="esr-submit-msg" class="small mt-2 d-none"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Preference-Weighted Regime (RLHF Loop) -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-arrow-repeat"></i> Preference-Weighted Recommendation</h5>
                    <p class="text-muted small">Combines physics-based auto-detection with expert consensus. If enough experts have voted, their preferences influence the recommendation.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-success btn-sm" onclick="runPreferenceWeightedRegime()">
                            <i class="bi bi-play-fill"></i> Get Weighted Recommendation
                        </button>
                    </div>

                    <div id="pwr-results" class="d-none">
                        <div id="pwr-recommendation" class="alert alert-info mb-3"></div>
                        <div id="pwr-blend-source" class="small text-muted mb-3"></div>
                        <div class="row g-3 mb-3" id="pwr-comparison"></div>
                    </div>

                    <!-- Regime Stability Check -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-shield-exclamation"></i> Regime Stability Check</h5>
                    <p class="text-muted small">Tests if the recommended regime changes under realistic parameter variations (pore pressure ±5-10 MPa, depth ±200m). Unstable regimes should NOT be trusted for operational decisions.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-danger btn-sm" onclick="runRegimeStability()">
                            <i class="bi bi-shield-check"></i> Run Stability Check
                        </button>
                    </div>

                    <div id="rs-results" class="d-none">
                        <div id="rs-grade" class="card mb-3">
                            <div class="card-body text-center py-3">
                                <div id="rs-stability-label" class="display-6 fw-bold">--</div>
                                <div id="rs-baseline" class="text-muted mt-1"></div>
                                <div id="rs-message" class="mt-2"></div>
                                <div id="rs-summary" class="small text-muted mt-1"></div>
                            </div>
                        </div>

                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>Perturbation</th>
                                    <th>Regime</th>
                                    <th>Confidence</th>
                                    <th>Misfit Ratio</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="rs-perturbation-tbody"></tbody>
                        </table>
                    </div>

                    <!-- Expert Preference History -->
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-clock-history"></i> Expert Preference History</h5>
                    <p class="text-muted small">View accumulated expert selections and how consensus has evolved over time.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-info btn-sm" onclick="loadExpertHistory()">
                            <i class="bi bi-list-check"></i> Load History
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="resetExpertPreferences()">
                            <i class="bi bi-trash"></i> Reset Preferences
                        </button>
                    </div>

                    <div id="eph-results" class="d-none">
                        <div class="mb-3" id="eph-consensus"></div>
                        <div class="row g-3 mb-3" id="eph-well-summaries"></div>

                        <div class="card mb-3">
                            <div class="card-header">Selection Timeline</div>
                            <div class="card-body p-0">
                                <table class="table table-sm mb-0">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Timestamp</th>
                                            <th>Selected</th>
                                            <th>Dominant</th>
                                            <th>Consensus %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="eph-timeline-tbody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scenario Comparison Tab -->
                <div id="tab-scenarios" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-sliders"></i> What-If Scenario Comparison</h5>
                    <p class="text-muted small">Compare different stress regime assumptions side-by-side. See how pore pressure and regime choice affect drilling decisions. Define 2-6 scenarios below.</p>

                    <div class="card mb-3">
                        <div class="card-header">Define Scenarios</div>
                        <div class="card-body">
                            <div id="scenario-list">
                                <div class="row g-2 mb-2 scenario-row">
                                    <div class="col-md-3"><input type="text" class="form-control form-control-sm scenario-name" placeholder="Scenario name" value="Normal Fault"></div>
                                    <div class="col-md-3">
                                        <select class="form-select form-select-sm scenario-regime">
                                            <option value="normal" selected>Normal</option>
                                            <option value="strike_slip">Strike-Slip</option>
                                            <option value="thrust">Thrust</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3"><input type="number" class="form-control form-control-sm scenario-pp" placeholder="Pore pressure (MPa)" value=""></div>
                                    <div class="col-md-3"><button class="btn btn-outline-danger btn-sm" onclick="removeScenario(this)"><i class="bi bi-trash"></i></button></div>
                                </div>
                                <div class="row g-2 mb-2 scenario-row">
                                    <div class="col-md-3"><input type="text" class="form-control form-control-sm scenario-name" placeholder="Scenario name" value="Strike-Slip"></div>
                                    <div class="col-md-3">
                                        <select class="form-select form-select-sm scenario-regime">
                                            <option value="normal">Normal</option>
                                            <option value="strike_slip" selected>Strike-Slip</option>
                                            <option value="thrust">Thrust</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3"><input type="number" class="form-control form-control-sm scenario-pp" placeholder="Pore pressure (MPa)" value=""></div>
                                    <div class="col-md-3"><button class="btn btn-outline-danger btn-sm" onclick="removeScenario(this)"><i class="bi bi-trash"></i></button></div>
                                </div>
                                <div class="row g-2 mb-2 scenario-row">
                                    <div class="col-md-3"><input type="text" class="form-control form-control-sm scenario-name" placeholder="Scenario name" value="Thrust"></div>
                                    <div class="col-md-3">
                                        <select class="form-select form-select-sm scenario-regime">
                                            <option value="normal">Normal</option>
                                            <option value="strike_slip">Strike-Slip</option>
                                            <option value="thrust" selected>Thrust</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3"><input type="number" class="form-control form-control-sm scenario-pp" placeholder="Pore pressure (MPa)" value=""></div>
                                    <div class="col-md-3"><button class="btn btn-outline-danger btn-sm" onclick="removeScenario(this)"><i class="bi bi-trash"></i></button></div>
                                </div>
                            </div>
                            <div class="d-flex gap-2 mt-2">
                                <button class="btn btn-outline-secondary btn-sm" onclick="addScenario()"><i class="bi bi-plus"></i> Add Scenario</button>
                                <button class="btn btn-primary btn-sm" onclick="runScenarios()"><i class="bi bi-play-fill"></i> Compare Scenarios</button>
                            </div>
                        </div>
                    </div>

                    <div id="scenario-results" class="d-none">
                        <div id="scenario-recommendation" class="alert alert-success mb-3"></div>
                        <div id="scenario-sensitivity-msg" class="alert alert-warning mb-3 small"></div>

                        <div class="card mb-3">
                            <div class="card-header">Scenario Results</div>
                            <div class="card-body p-0">
                                <table class="table table-sm table-striped mb-0" id="scenario-table">
                                    <thead><tr>
                                        <th>Scenario</th><th>Regime</th><th>&sigma;1</th><th>&sigma;3</th><th>SHmax</th><th>R</th><th>&mu;</th><th>Pp (MPa)</th><th>Misfit</th><th>Crit. Stressed %</th>
                                    </tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div id="scenario-spread" class="d-none">
                            <div class="card">
                                <div class="card-header">Parameter Sensitivity Across Scenarios</div>
                                <div class="card-body p-0">
                                    <table class="table table-sm mb-0" id="scenario-spread-table">
                                        <thead><tr><th>Parameter</th><th>Min</th><th>Max</th><th>Range</th><th>CV %</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monte Carlo Tab -->
                <div id="tab-montecarlo" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-dice-5"></i> Monte Carlo Uncertainty Propagation</h5>
                    <p class="text-muted">How do measurement errors affect your results? This propagates realistic uncertainties (azimuth ±5°, dip ±3°, depth ±2m) through the full inversion to quantify output precision.</p>

                    <div class="row g-3 mb-3">
                        <div class="col-md-2">
                            <label class="form-label small">Simulations</label>
                            <input type="number" id="mc-nsims" class="form-control form-control-sm" value="200" min="50" max="1000">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Az σ (°)</label>
                            <input type="number" id="mc-az-std" class="form-control form-control-sm" value="5" min="1" max="20" step="0.5">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Dip σ (°)</label>
                            <input type="number" id="mc-dip-std" class="form-control form-control-sm" value="3" min="1" max="15" step="0.5">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Depth σ (m)</label>
                            <input type="number" id="mc-dep-std" class="form-control form-control-sm" value="2" min="0.5" max="20" step="0.5">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-primary btn-sm w-100" onclick="runMonteCarlo()">
                                <i class="bi bi-dice-5"></i> Run
                            </button>
                        </div>
                    </div>

                    <div id="mc-results" class="d-none">
                        <!-- Reliability Banner -->
                        <div id="mc-reliability" class="alert mb-3"></div>

                        <!-- Statistics Table -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-table"></i> Output Distributions (95% CI)</div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm small">
                                        <thead><tr><th>Parameter</th><th>Mean</th><th>Median</th><th>Std Dev</th><th>95% CI Lower</th><th>95% CI Upper</th><th>CI Width</th></tr></thead>
                                        <tbody id="mc-stats-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Sensitivity Ranking -->
                        <div class="card mb-3">
                            <div class="card-header"><i class="bi bi-sort-down"></i> Input Sensitivity Ranking</div>
                            <div class="card-body" id="mc-sensitivity-body"></div>
                        </div>
                    </div>
                </div>

                <!-- Data Validation Tab -->
                <div id="tab-validation" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-check2-all"></i> Domain Constraint Validation</h5>
                    <p class="text-muted">Validates your data against physical and geological constraints before analysis. Catches impossible values, unusual combinations, and data anomalies.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="runDomainValidation()">
                            <i class="bi bi-check2-all"></i> Validate Data
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="runCrossWellCV()">
                            <i class="bi bi-building"></i> Cross-Well Validation
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="runExpertEnsemble()">
                            <i class="bi bi-people"></i> Expert Ensemble
                        </button>
                    </div>

                    <!-- Domain Validation Results -->
                    <div id="val-results" class="d-none mb-4">
                        <div id="val-status" class="alert mb-3"></div>
                        <div id="val-issues-body"></div>
                    </div>

                    <!-- Cross-Well CV Results -->
                    <div id="cwcv-results" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-building"></i> Leave-One-Well-Out Cross-Validation</div>
                            <div class="card-body">
                                <div id="cwcv-transfer" class="alert mb-3"></div>
                                <div class="table-responsive">
                                    <table class="table table-sm small">
                                        <thead><tr><th>Well (Held Out)</th><th>Train</th><th>Test</th><th>Accuracy</th><th>Balanced Acc</th><th>Per-Class F1</th></tr></thead>
                                        <tbody id="cwcv-table-body"></tbody>
                                    </table>
                                </div>
                                <h6 class="small fw-bold mt-3">Within-Well Performance</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm small">
                                        <thead><tr><th>Well</th><th>Samples</th><th>Classes</th><th>CV Accuracy</th></tr></thead>
                                        <tbody id="cwcv-within-body"></tbody>
                                    </table>
                                </div>
                                <div id="cwcv-recommendation" class="mt-3 small text-muted"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Expert Ensemble Results -->
                    <div id="ee-results" class="d-none mb-4">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-people"></i> Expert-Weighted Ensemble (RLHF-style)</div>
                            <div class="card-body">
                                <div id="ee-summary" class="mb-3"></div>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <h6 class="small fw-bold">Model Weights</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm small">
                                                <thead><tr><th>Model</th><th>Base Weight</th><th>Expert Weight</th><th>CV Accuracy</th></tr></thead>
                                                <tbody id="ee-weights-body"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="small fw-bold">Per-Class Impact</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm small">
                                                <thead><tr><th>Class</th><th>Equal F1</th><th>Expert F1</th><th>Delta</th></tr></thead>
                                                <tbody id="ee-class-body"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audit Trail Tab -->
                <div id="tab-audit" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-shield-check"></i> Prediction Audit Trail</h5>
                    <p class="text-muted small">Every analysis action is recorded with timestamp, parameters, and result hash for regulatory compliance and traceability. Records are integrity-verified with SHA-256 hashes.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="loadAuditLog()">
                            <i class="bi bi-arrow-clockwise"></i> Refresh Log
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="exportAuditLog()">
                            <i class="bi bi-download"></i> Export CSV
                        </button>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <div class="metric-card">
                                <div class="metric-label">Total Records</div>
                                <div class="metric-value" id="audit-total">0</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card">
                                <div class="metric-label">App Version</div>
                                <div class="metric-value" id="audit-version">2.6.0</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card">
                                <div class="metric-label">Session Start</div>
                                <div class="metric-value" id="audit-session-start" style="font-size:0.9rem">--</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Recent Analysis Actions</div>
                        <div class="card-body p-0">
                            <table class="table table-sm table-striped mb-0" id="audit-table">
                                <thead><tr>
                                    <th>#</th><th>Time</th><th>Action</th><th>Well</th><th>Source</th><th>Elapsed</th><th>Hash</th>
                                </tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Glossary Tab -->
                <!-- Research & Methods Tab -->
                <div id="tab-research" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-mortarboard"></i> Scientific Methods & Research Basis</h5>
                    <p class="text-muted">Understanding what factors are accounted for and the scientific basis of each analysis. Based on peer-reviewed geomechanics research through 2025-2026.</p>

                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary btn-sm" onclick="loadResearchMethods()">
                            <i class="bi bi-arrow-clockwise"></i> Load Methods
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="runPhysicsCheck()">
                            <i class="bi bi-gear-wide"></i> Physics Constraint Check
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="runPhysicsPredict()">
                            <i class="bi bi-shield-check"></i> Physics-Constrained Predict
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="runMisclassification()">
                            <i class="bi bi-bug"></i> Misclassification Analysis
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="runModelBias()">
                            <i class="bi bi-sliders2"></i> Bias Detection
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="runReliabilityReport()">
                            <i class="bi bi-award"></i> Reliability Report
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="runPredictWithAbstention()">
                            <i class="bi bi-shield-exclamation"></i> Predict with Abstention
                        </button>
                    </div>
                    <!-- Abstention threshold slider -->
                    <div class="mt-2 px-2" style="max-width:350px">
                        <label class="form-label small mb-0">Abstention Threshold:
                            <span id="abstention-threshold-val">60%</span></label>
                        <input type="range" class="form-range form-range-sm" id="abstention-threshold"
                               min="0.30" max="0.95" step="0.05" value="0.60">
                    </div>

                    <div id="research-body"></div>

                    <!-- Model Bias Results -->
                    <div id="bias-results" class="d-none mt-3">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-sliders2"></i> Model Bias Detection</div>
                            <div class="card-body" id="bias-body"></div>
                        </div>
                    </div>

                    <!-- Reliability Report Results -->
                    <div id="reliability-results" class="d-none mt-3">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark"><i class="bi bi-award"></i> Prediction Reliability Report</div>
                            <div class="card-body" id="reliability-body"></div>
                        </div>
                    </div>

                    <!-- Prediction Abstention Results -->
                    <div id="abstention-results" class="d-none mt-3">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <i class="bi bi-shield-exclamation"></i> Prediction Abstention — Safety-Critical Refusal
                            </div>
                            <div class="card-body" id="abstention-body"></div>
                        </div>
                    </div>

                    <!-- Physics Constrained Prediction Results -->
                    <div id="physics-predict-results" class="d-none mt-3">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-shield-check"></i> Physics-Constrained Prediction</div>
                            <div class="card-body" id="physics-predict-body"></div>
                        </div>
                    </div>

                    <!-- Misclassification Analysis Results -->
                    <div id="misclass-results" class="d-none mt-3">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-bug"></i> Misclassification Analysis</div>
                            <div class="card-body" id="misclass-body"></div>
                        </div>
                    </div>

                    <!-- Physics Check Results -->
                    <div id="physics-results" class="d-none mt-3">
                        <div class="card">
                            <div class="card-header"><i class="bi bi-gear-wide"></i> Physics Constraint Validation</div>
                            <div class="card-body">
                                <div id="physics-status" class="alert mb-3"></div>
                                <div id="physics-issues"></div>
                                <div id="physics-constraints" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-glossary" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-book"></i> Geomechanics Glossary & Decision Guide</h5>
                    <p class="text-muted">Plain-language explanations for non-technical stakeholders. Understand what the numbers mean before making drilling decisions.</p>

                    <!-- Stress & Pressure -->
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white"><i class="bi bi-arrows-angle-expand"></i> Stress & Pressure Terms</div>
                        <div class="card-body">
                            <dl class="row mb-0">
                                <dt class="col-sm-3">Principal Stresses (&#963;1, &#963;2, &#963;3)</dt>
                                <dd class="col-sm-9">The three main forces squeezing the rock underground, measured in MPa (megapascals). &#963;1 is the strongest, &#963;3 the weakest. <strong>Think of it as:</strong> squeezing a sponge from three sides &mdash; one direction always pushes hardest.</dd>

                                <dt class="col-sm-3">SHmax (Maximum Horizontal Stress Azimuth)</dt>
                                <dd class="col-sm-9">The compass direction of the strongest horizontal squeeze. <strong>Why it matters:</strong> Drilling perpendicular to SHmax reduces borehole instability. This is the single most important output for well planning. Reported as degrees from North (0-360).</dd>

                                <dt class="col-sm-3">R Ratio</dt>
                                <dd class="col-sm-9">How "round" vs "cigar-shaped" the stress ellipsoid is (0 to 1). R=0 means &#963;2 equals &#963;3, R=1 means &#963;2 equals &#963;1. <strong>Practical impact:</strong> R near 0.5 = all three stresses are distinct; near 0 or 1 = two stresses are similar, so stress direction is less constrained.</dd>

                                <dt class="col-sm-3">Pore Pressure (Pp)</dt>
                                <dd class="col-sm-9">The pressure of fluids (water, oil, gas) inside the rock pores, in MPa. Default estimate uses hydrostatic gradient (1020 kg/m3 water). <strong>Critical:</strong> Higher pore pressure makes fractures more likely to slip. This is consistently the #1 source of uncertainty in our analysis.</dd>

                                <dt class="col-sm-3">Overburden Stress (Sv)</dt>
                                <dd class="col-sm-9">The weight of all rock above a given depth. Calculated from rock density (2500 kg/m3) times depth times gravity. This sets the scale for all other stress estimates.</dd>
                            </dl>
                        </div>
                    </div>

                    <!-- Stress Regime -->
                    <div class="card mb-3">
                        <div class="card-header bg-info text-white"><i class="bi bi-globe"></i> Stress Regimes (Faulting Styles)</div>
                        <div class="card-body">
                            <dl class="row mb-0">
                                <dt class="col-sm-3">Normal Faulting</dt>
                                <dd class="col-sm-9">The vertical stress is the greatest (&#963;1 = Sv). Rock extends apart horizontally. <strong>Typical setting:</strong> rift basins, passive margins. Fractures tend to be steep and parallel to SHmax.</dd>

                                <dt class="col-sm-3">Strike-Slip</dt>
                                <dd class="col-sm-9">The vertical stress is intermediate (&#963;2 = Sv). Rock shears horizontally. <strong>Typical setting:</strong> transform boundaries. Both vertical and sub-horizontal fractures are common.</dd>

                                <dt class="col-sm-3">Thrust (Reverse) Faulting</dt>
                                <dd class="col-sm-9">The vertical stress is the weakest (&#963;3 = Sv). Rock compresses horizontally. <strong>Typical setting:</strong> compressional margins, fold-thrust belts. Low-angle fractures dominate.</dd>

                                <dt class="col-sm-3">Regime Confidence</dt>
                                <dd class="col-sm-9"><span class="badge bg-success">HIGH</span> = clear winner (1 regime fits much better). <span class="badge bg-warning text-dark">MODERATE</span> = likely but not definitive. <span class="badge bg-danger">LOW</span> = all regimes fit similarly; independent data (borehole breakouts, drilling-induced fractures) needed to resolve.</dd>
                            </dl>
                        </div>
                    </div>

                    <!-- Fracture Properties -->
                    <div class="card mb-3">
                        <div class="card-header bg-warning text-dark"><i class="bi bi-hurricane"></i> Fracture Properties</div>
                        <div class="card-body">
                            <dl class="row mb-0">
                                <dt class="col-sm-3">Fracture Azimuth</dt>
                                <dd class="col-sm-9">The compass direction the fracture plane faces (0-360 degrees from North). <strong>Example:</strong> Azimuth 90 = fracture faces East.</dd>

                                <dt class="col-sm-3">Fracture Dip</dt>
                                <dd class="col-sm-9">How steeply the fracture tilts from horizontal (0-90 degrees). 0 = flat; 90 = vertical.</dd>

                                <dt class="col-sm-3">Slip Tendency</dt>
                                <dd class="col-sm-9">How close a fracture is to sliding (shear stress / normal stress). <strong>Range:</strong> 0 to 1+. Values above the friction coefficient (~0.6) mean the fracture is likely sliding. <span class="text-danger fw-bold">High slip tendency = potential wellbore instability.</span></dd>

                                <dt class="col-sm-3">Dilation Tendency</dt>
                                <dd class="col-sm-9">How likely a fracture is to open and allow fluid flow (0 to 1). <strong>High values (>0.7):</strong> fracture is likely a fluid conduit. <span class="text-success fw-bold">Can be beneficial (natural fracture network) or harmful (lost circulation).</span></dd>

                                <dt class="col-sm-3">Critically Stressed</dt>
                                <dd class="col-sm-9">Fractures whose slip tendency exceeds the Mohr-Coulomb criterion. These fractures are at or past the point of failure. <strong>Operational impact:</strong> High % critically stressed = higher risk of induced seismicity, lost circulation, and wellbore instability.</dd>
                            </dl>
                        </div>
                    </div>

                    <!-- Risk Interpretation -->
                    <div class="card mb-3">
                        <div class="card-header bg-danger text-white"><i class="bi bi-shield-exclamation"></i> Risk Categories Explained</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead>
                                        <tr><th>Risk Level</th><th>What It Means</th><th>Recommended Action</th></tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-success"><td><span class="badge bg-success">LOW</span></td><td>Critically stressed <20%, high data quality, good model confidence</td><td>Proceed with standard drilling program</td></tr>
                                        <tr class="table-warning"><td><span class="badge bg-warning text-dark">MODERATE</span></td><td>Some fractures at risk, moderate uncertainty</td><td>Use managed pressure drilling, plan contingencies</td></tr>
                                        <tr class="table-danger"><td><span class="badge bg-danger">HIGH</span></td><td>>30% critically stressed, low data quality or model confidence</td><td>Commission additional data before drilling. Consider alternative well trajectory.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Model Reliability -->
                    <div class="card mb-3">
                        <div class="card-header bg-secondary text-white"><i class="bi bi-robot"></i> Understanding AI Predictions</div>
                        <div class="card-body">
                            <dl class="row mb-0">
                                <dt class="col-sm-3">Standard Accuracy</dt>
                                <dd class="col-sm-9">How often the model is correct overall. <strong>Limitation:</strong> Can be misleadingly high if one fracture type dominates. Example: if 50% of data is Vuggy, a model that always says "Vuggy" gets 50% accuracy while being useless.</dd>

                                <dt class="col-sm-3">Balanced Accuracy</dt>
                                <dd class="col-sm-9">Accuracy calculated separately for each fracture type, then averaged. <strong>More honest</strong> when class sizes differ. If standard accuracy is 88% but balanced is 56%, the model is failing on rare fracture types.</dd>

                                <dt class="col-sm-3">SMOTE (Synthetic Minority Over-sampling)</dt>
                                <dd class="col-sm-9">When some fracture types have very few samples, SMOTE creates realistic synthetic examples by interpolating between existing ones. This helps the model learn rare types. <strong>Automatically applied</strong> when class imbalance is detected.</dd>

                                <dt class="col-sm-3">Calibration (ECE)</dt>
                                <dd class="col-sm-9">Expected Calibration Error measures whether the model's confidence values are reliable. ECE <5% = excellent (confidence values can be trusted). ECE >20% = poor (don't rely on probability estimates).</dd>

                                <dt class="col-sm-3">Out-of-Distribution (OOD)</dt>
                                <dd class="col-sm-9">When you upload new data, we check if it looks similar to the training data. If the new data is "out of distribution" (different depth range, formation, etc.), model predictions will be unreliable. <span class="text-danger fw-bold">Always check OOD before trusting predictions on new data.</span></dd>

                                <dt class="col-sm-3">Overfitting</dt>
                                <dd class="col-sm-9">When a model memorizes the training data instead of learning general patterns. Measured by the gap between training accuracy and cross-validation accuracy. Gap >10% = significant overfitting risk.</dd>
                            </dl>
                        </div>
                    </div>

                    <!-- Decision Flowchart -->
                    <div class="card mb-3 border-success">
                        <div class="card-header bg-success text-white"><i class="bi bi-signpost-split"></i> Decision Flowchart: Should I Trust These Results?</div>
                        <div class="card-body">
                            <ol class="mb-0">
                                <li class="mb-2"><strong>Check Data Quality score.</strong> If grade is D or F, stop &mdash; fix data issues first.</li>
                                <li class="mb-2"><strong>Check Regime Confidence.</strong> If LOW, do not rely on SHmax direction. Collect borehole breakout data.</li>
                                <li class="mb-2"><strong>Check Balanced Accuracy.</strong> If below 60%, classification is unreliable. Consider merging rare fracture types or collecting more data.</li>
                                <li class="mb-2"><strong>If using uploaded data:</strong> Check the OOD (distribution) result. If HIGH severity, retrain before using predictions.</li>
                                <li class="mb-2"><strong>Check Calibration.</strong> If POOR, don't use probability values for risk decisions. Use binary yes/no classification instead.</li>
                                <li class="mb-2"><strong>Review the Risk Matrix.</strong> If HIGH risk, escalate to senior geomechanics engineer before proceeding.</li>
                                <li class="mb-2"><strong>Check the Uncertainty Budget.</strong> Pore pressure is consistently the #1 source of uncertainty. If you have measured Pp data, input it to dramatically improve reliability.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- MLOps Tab -->
                <div id="tab-mlops" class="tab-content">
                    <h5 class="mb-3"><i class="bi bi-gear-wide-connected"></i> Production MLOps Dashboard</h5>

                    <!-- Live Status Bar (auto-refreshes) -->
                    <div class="alert alert-light border d-flex align-items-center justify-content-between py-2 mb-3" id="mlops-status-bar">
                        <div class="d-flex align-items-center gap-3">
                            <span id="mlops-health-dot" class="badge rounded-pill bg-secondary">...</span>
                            <small class="text-muted">Health: <strong id="mlops-health-score">--</strong>/100</small>
                            <small class="text-muted">|</small>
                            <small class="text-muted">Models: <strong id="mlops-model-count">--</strong></small>
                            <small class="text-muted">|</small>
                            <small class="text-muted">Failures: <strong id="mlops-failure-count">--</strong></small>
                            <small class="text-muted">|</small>
                            <small class="text-muted">RLHF Reviews: <strong id="mlops-rlhf-count">--</strong></small>
                        </div>
                        <small class="text-muted" id="mlops-last-refresh">--</small>
                    </div>

                    <!-- System Health -->
                    <div class="card mb-3 border-primary">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-heart-pulse"></i> System Health</span>
                            <button class="btn btn-sm btn-outline-light" onclick="loadSystemHealth()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                        </div>
                        <div class="card-body" id="system-health-result">
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>

                    <!-- Data Drift Detection -->
                    <div class="card mb-3">
                        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-graph-down-arrow"></i> Data Drift Detection</span>
                            <div>
                                <button class="btn btn-sm btn-outline-dark me-1" onclick="runDriftDetection()"><i class="bi bi-search"></i> Check Drift</button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="resetDriftBaseline()"><i class="bi bi-arrow-counterclockwise"></i> Reset Baseline</button>
                            </div>
                        </div>
                        <div class="card-body" id="drift-result">
                            <p class="text-muted">Run drift detection to compare current data against the baseline distribution. Catches silent model degradation.</p>
                        </div>
                    </div>

                    <!-- Model Version Registry -->
                    <div class="card mb-3">
                        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-tags"></i> Model Version Registry</span>
                            <div>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="loadModelRegistry()"><i class="bi bi-list-ul"></i> List Versions</button>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="registerModel()"><i class="bi bi-plus-circle"></i> Register</button>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="compareModelVersions()"><i class="bi bi-arrow-left-right"></i> Compare</button>
                                <button class="btn btn-sm btn-outline-warning me-1" onclick="runAbTest()"><i class="bi bi-shuffle"></i> A/B Test</button>
                                <button class="btn btn-sm btn-success" onclick="runEnsembleVote()"><i class="bi bi-check2-all"></i> Ensemble Vote</button>
                            </div>
                        </div>
                        <div class="card-body" id="model-registry-result">
                            <p class="text-muted">Track model versions, compare performance, and rollback if needed.</p>
                        </div>
                        <div id="ab-test-brief" class="d-none"></div>
                    </div>

                    <!-- Field Stress Integration -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-globe-americas"></i> Multi-Well Field Stress Model</span>
                            <button class="btn btn-sm btn-outline-light" onclick="runFieldStressModel()"><i class="bi bi-play-circle"></i> Integrate Wells</button>
                        </div>
                        <div class="card-body" id="field-stress-result">
                            <p class="text-muted">Combine stress estimates from all wells into a unified field model. Detects structural domain boundaries.</p>
                        </div>
                    </div>

                    <!-- Failure Case Learning -->
                    <div class="card mb-3">
                        <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-triangle"></i> Failure Case Learning</span>
                            <div>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="viewFailureAnalysis()"><i class="bi bi-bar-chart"></i> Analyze Patterns</button>
                                <button class="btn btn-sm btn-outline-light" onclick="retrainWithFailures()"><i class="bi bi-lightning"></i> Retrain</button>
                            </div>
                        </div>
                        <div class="card-body" id="failure-analysis-result">
                            <p class="text-muted">Systematically learn from prediction failures. Record wrong predictions, analyze patterns, and retrain with failure-aware weighting.</p>
                        </div>
                    </div>

                    <!-- RLHF Review Queue -->
                    <div class="card mb-3 border-primary">
                        <div class="card-header bg-primary bg-opacity-75 text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-person-check"></i> RLHF Expert Review Queue</span>
                            <div>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="loadRlhfQueue()"><i class="bi bi-list-task"></i> Get Review Queue</button>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="viewRlhfImpact()"><i class="bi bi-graph-up"></i> View Impact</button>
                                <button class="btn btn-sm btn-warning" onclick="rlhfRetrain()"><i class="bi bi-lightning"></i> Apply & Retrain</button>
                            </div>
                        </div>
                        <div class="card-body" id="rlhf-queue-result">
                            <p class="text-muted">Get a prioritized queue of samples for expert review. The system identifies the most uncertain predictions that would benefit most from expert feedback. <strong>This is how AI learns from your expertise.</strong></p>
                        </div>
                    </div>

                    <!-- Batch Analysis -->
                    <div class="card mb-3 border-dark">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-collection"></i> Batch Analysis (All Wells)</span>
                            <button class="btn btn-sm btn-outline-dark" onclick="runBatchAnalysis()"><i class="bi bi-play-fill"></i> Analyze All Wells</button>
                        </div>
                        <div class="card-body" id="batch-result">
                            <p class="text-muted">Run stress inversion + ML classification + data quality across all wells simultaneously. Produces a field-wide summary.</p>
                        </div>
                    </div>

                    <!-- Report Failure Form -->
                    <div class="card mb-3 border-secondary">
                        <div class="card-header"><i class="bi bi-flag"></i> Report a Prediction Failure</div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label class="form-label form-label-sm">Failure Type</label>
                                    <select id="failure-type" class="form-select form-select-sm">
                                        <option value="wrong_prediction">Wrong Prediction</option>
                                        <option value="rejected_result">Rejected Result</option>
                                        <option value="suspicious_output">Suspicious Output</option>
                                        <option value="overconfident">Overconfident Wrong</option>
                                        <option value="data_issue">Data Issue</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label form-label-sm">Predicted</label>
                                    <input type="text" id="failure-predicted" class="form-control form-control-sm" placeholder="e.g. Vuggy">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label form-label-sm">Actual</label>
                                    <input type="text" id="failure-actual" class="form-control form-control-sm" placeholder="e.g. Continuous">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label form-label-sm">Depth (m)</label>
                                    <input type="number" id="failure-depth" class="form-control form-control-sm" placeholder="e.g. 2950">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label form-label-sm">Description</label>
                                    <input type="text" id="failure-description" class="form-control form-control-sm" placeholder="What went wrong?">
                                </div>
                            </div>
                            <button class="btn btn-sm btn-danger mt-2" onclick="reportFailure()"><i class="bi bi-flag-fill"></i> Submit Failure Report</button>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index:9999">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">GeoStress AI</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-body"></div>
        </div>
    </div>

    <!-- Floating Help Button -->
    <button class="btn btn-info position-fixed shadow-lg rounded-circle"
            style="bottom:24px;right:24px;width:56px;height:56px;z-index:1050;font-size:1.4rem;"
            data-bs-toggle="modal" data-bs-target="#glossaryModal"
            title="Help: What do these terms mean?">
        <i class="bi bi-question-circle"></i>
    </button>

    <!-- Glossary Modal -->
    <div class="modal fade" id="glossaryModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-info bg-opacity-10">
                    <h5 class="modal-title"><i class="bi bi-book"></i> Glossary — Plain Language Guide</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="glossary-body">
                    <p class="text-muted">Loading glossary...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Initialize all Bootstrap tooltips
    document.addEventListener("DOMContentLoaded", function() {
        var ttEls = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        ttEls.forEach(function(el) { new bootstrap.Tooltip(el, {trigger: "hover focus", html: true}); });
    });
    </script>
    <script src="/static/js/app.js"></script>
</body>
</html>
